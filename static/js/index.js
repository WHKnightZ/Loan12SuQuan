(()=>{"use strict";var e={131:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadTextures=t.barTextures=t.menuTexture=t.hintArrows=t.cornerSelections=void 0;const s=a(876),o=a(451),i=a(555),n=e=>{const t=new Image;return t.src=(0,i.getImageSrc)(e),new Promise((e=>t.onload=()=>e(t)))},r=async()=>{await Promise.all((0,i.getKeys)(s.TILES).map((e=>((e,t)=>{const a=new Image;return a.src=(0,i.getImageSrc)(`tiles/${t}`),new Promise((t=>a.onload=async()=>{const o=e=>{const t=Math.floor(a.width/s.TILE_LENGTH*s.SCALE_RATIO),o=Math.floor(a.height*s.SCALE_RATIO),i=document.createElement("canvas");i.width=t,i.height=o;const n=i.getContext("2d");n.imageSmoothingEnabled=!1;const r=a.width/s.TILE_LENGTH*e,l=a.width/s.TILE_LENGTH;n.drawImage(a,r,0,l,a.height,0,0,t,o);const E=new Image;return E.src=i.toDataURL("image/png"),new Promise((e=>E.onload=()=>e(E)))};s.mapTileInfo[e].texture=await o(0),s.mapTileInfo[e].explosions=[];for(let t=0;t<6;t+=1)s.mapTileInfo[e].explosions[t]=await o(t+1);t(null)}))})(s.TILES[e],e.toLowerCase()))))};t.cornerSelections=[];const l=()=>{t.cornerSelections=[];let e=new Image;return e.src=(0,i.getImageSrc)("selection/corner"),new Promise((a=>{e.onload=async()=>{const i=await(0,o.flipHorizontal)(e),n=await(0,o.flipVertical)(e),r=await(0,o.flipVertical)(i),l=e.width,E=s.CELL_SIZE-l;t.cornerSelections.push({texture:e,position:{x:0,y:0},offset:{x:1,y:1}}),t.cornerSelections.push({texture:i,position:{x:E,y:0},offset:{x:-1,y:1}}),t.cornerSelections.push({texture:n,position:{x:0,y:E},offset:{x:1,y:-1}}),t.cornerSelections.push({texture:r,position:{x:E,y:E},offset:{x:-1,y:-1}}),a(null)}}))};t.hintArrows={};const E=async()=>{let e=new Image;e.src=(0,i.getImageSrc)("common/hint-arrow"),await new Promise((t=>e.onload=async()=>{e=await(0,o.resize)(e,2),t(null)})),t.hintArrows.UP={offset:{x:(s.CELL_SIZE-e.width)/2,y:-6},texture:e,drt:{x:0,y:-1}},e=await(0,o.rotateCW90)(e),t.hintArrows.RIGHT={offset:{x:s.CELL_SIZE-e.width+6,y:(s.CELL_SIZE-e.height)/2},texture:e,drt:{x:1,y:0}},e=await(0,o.rotateCW90)(e),t.hintArrows.DOWN={offset:{x:(s.CELL_SIZE-e.width)/2,y:s.CELL_SIZE-e.height+6},texture:e,drt:{x:0,y:1}},e=await(0,o.rotateCW90)(e),t.hintArrows.LEFT={offset:{x:-6,y:(s.CELL_SIZE-e.height)/2},texture:e,drt:{x:-1,y:0}}};t.menuTexture=null,t.barTextures={};const c=async()=>{t.menuTexture=await n("common/menu"),t.menuTexture=await(0,o.resize)(t.menuTexture,2);const e=["life","energy","mana"];let a=await Promise.all(e.map((e=>n(`common/${e}bar`))));a=await Promise.all(a.map((e=>(0,o.resize)(e,2)))),a.forEach(((a,s)=>{t.barTextures[e[s]]=a}))};t.loadTextures=()=>Promise.all([r(),l(),E(),c()])},876:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hintArrowOffsets=t.cornerSelectionOffsets=t.base=t.mapTileInfo=t.COUNT_TILES=t.TILES=t.LOSE_ENERGY_INTERVAL=t.DEFAULT_ENERGY=t.DEFAULT_MANA=t.PLAYER_INTELLIGENCE=t.HINT_ARROW_CYCLE=t.CORNER_SELECTION_CYCLE=t.SCALE_RATIO=t.GRAVITY=t.VELOCITY_BASE=t.SWAP_OFFSET=t.SWAP_DURATION=t.MATCH_4_POINT=t.GAIN_TURN=t.TILE_OFFSET=t.TILE_LENGTH=t.REAL_TILE_SIZE=t.TILE_SIZE=t.SCREEN_HEIGHT=t.SCREEN_WIDTH=t.MENU_HEIGHT=t.BOARD_SIZE=t.CELL_SIZE=t.TOTAL_TILES=t.MAP_WIDTH_1=t.MAP_WIDTH=t.BOARD_COLORS=t.APP_NAME=void 0,t.APP_NAME="Loạn 12 Sứ Quân",t.BOARD_COLORS=["#3e3226","#554933"],t.MAP_WIDTH=8,t.MAP_WIDTH_1=t.MAP_WIDTH-1,t.TOTAL_TILES=t.MAP_WIDTH*t.MAP_WIDTH,t.CELL_SIZE=60,t.BOARD_SIZE=t.MAP_WIDTH*t.CELL_SIZE,t.MENU_HEIGHT=96,t.SCREEN_WIDTH=t.BOARD_SIZE,t.SCREEN_HEIGHT=t.BOARD_SIZE+t.MENU_HEIGHT,t.TILE_SIZE=50,t.REAL_TILE_SIZE=28,t.TILE_LENGTH=7,t.TILE_OFFSET=Math.floor((t.CELL_SIZE-t.TILE_SIZE)/2),t.GAIN_TURN=3,t.MATCH_4_POINT=50,t.SWAP_DURATION=10,t.SWAP_OFFSET=t.CELL_SIZE/t.SWAP_DURATION,t.VELOCITY_BASE=2,t.GRAVITY=.4,t.SCALE_RATIO=t.TILE_SIZE/t.REAL_TILE_SIZE,t.CORNER_SELECTION_CYCLE=30,t.HINT_ARROW_CYCLE=30,t.PLAYER_INTELLIGENCE=40,t.DEFAULT_MANA=100,t.DEFAULT_ENERGY=100,t.LOSE_ENERGY_INTERVAL=300,t.TILES={SWORD:0,HEART:1,GOLD:2,ENERGY:3,MANA:4,EXP:5,SWORDRED:6},t.COUNT_TILES=Object.keys(t.TILES).length,t.mapTileInfo={[t.TILES.SWORD]:{compatible:[t.TILES.SWORDRED],probability:90,point:10,texture:null,explosions:[]},[t.TILES.HEART]:{compatible:[],probability:100,point:9,texture:null,explosions:[]},[t.TILES.GOLD]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[t.TILES.ENERGY]:{compatible:[],probability:100,point:7,texture:null,explosions:[]},[t.TILES.MANA]:{compatible:[],probability:100,point:8,texture:null,explosions:[]},[t.TILES.EXP]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[t.TILES.SWORDRED]:{compatible:[t.TILES.SWORD],probability:10,point:30,texture:null,explosions:[]}},t.base={},t.cornerSelectionOffsets=Array.from({length:t.CORNER_SELECTION_CYCLE}).map(((e,a)=>Math.floor(3*Math.sin(2*Math.PI*a/t.CORNER_SELECTION_CYCLE)))),t.hintArrowOffsets=Array.from({length:t.HINT_ARROW_CYCLE}).map(((e,a)=>Math.floor(3*Math.sin(2*Math.PI*a/t.HINT_ARROW_CYCLE))))},988:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),o=a(555),i={render:e=>{e.explosions.forEach((({x:t,y:a,value:o})=>{const i=s.mapTileInfo[o].explosions[e.tExplode];s.base.context.drawImage(i,t*s.CELL_SIZE+Math.floor((s.CELL_SIZE-i.width)/2),a*s.CELL_SIZE+Math.floor((s.CELL_SIZE-i.height)/2))}))},update:e=>{if(e.tExplode2+=1,e.tExplode2%2!=0)return;if(e.tExplode+=1,4!==e.tExplode)return;e.tExplode=0,e.state="FALL",e.fall={};const t=e.fall;e.explodedTiles.forEach((({x:a,y:o})=>{s.base.map[o][a]=-1,e.fall[a]?!t[a].list.find((({x:e,y:t})=>e===a&&t===o))&&t[a].list.push({x:a,y:o,v:0,offset:0,value:-1}):t[a]={list:[{x:a,y:o,v:0,offset:0,value:-1}],below:-1}})),(0,o.getKeys)(t).forEach((a=>{t[a].below=(0,o.findBelow)(t[a].list);const i=t[a].list.length;t[a].list=[],a=Number(a);for(let o=e.fall[a].below;o>=0;o-=1)-1!==s.base.map[o][a]&&(t[a].list.push({x:a,y:o,v:s.VELOCITY_BASE,offset:0,value:s.base.map[o][a]}),s.base.map[o][a]=-1);for(let e=0;e<i;e+=1)t[a].list.push({x:a,y:-1-e,v:s.VELOCITY_BASE,offset:0,value:(0,o.randomTile)()})}))}};t.default=i},613:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),o=a(555),i=a(774);let n=[];const r=(e,t,a)=>(0,i.clamp)(3*(e+t+1)+7-a,0,10)/10,l={render:e=>{e.isFadeIn&&(e=>{const t=e.fall;(0,o.getKeys)(t).forEach((e=>{t[e].list.forEach((({x:e,y:t,value:a,offset:o})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET+o)}))})),n.forEach((({x:e,y:t,value:a})=>s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET)))})(e),e.isFadeOut&&(e=>{for(let t=0;t<s.MAP_WIDTH;t+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const o=a*s.CELL_SIZE,i=t*s.CELL_SIZE,n=r(a,t,e.tFadeOut),l=Math.floor(s.TILE_SIZE*n),E=Math.floor((s.CELL_SIZE-l)/2);0!==l&&s.base.context.drawImage(s.mapTileInfo[s.base.map[t][a]].texture,o+E,i+E,l,l)}})(e)},update:e=>{e.isFadeIn&&(e=>{e.tFadeIn+=1;const t=e.fall;for(let a=0;a<s.MAP_WIDTH;a+=1){let o=e.tFadeIn-3*a;o<1&&(o=1),o%6==0&&t[a].pushCount<s.MAP_WIDTH&&(t[a].list.push({x:a,y:-1,v:s.VELOCITY_BASE+4,offset:0,value:s.base.map[s.MAP_WIDTH_1-t[a].pushCount][a]}),t[a].pushCount+=1)}(0,o.getKeys)(t).forEach((a=>{const o=t[a];a=Number(a);let i=!1;if(o.list.forEach(((e,t)=>{e.v+=1.4*s.GRAVITY,e.offset+=e.v;const a=e.y+Math.floor((e.offset+6)/s.CELL_SIZE);0===t?a>=o.below&&(i=!0,o.below-=1):(e.offset>=o.list[t-1].offset-6||a>=o.below-t+1)&&(e.v=s.VELOCITY_BASE,e.offset=Math.floor(e.offset/s.CELL_SIZE)*s.CELL_SIZE)})),i){const t=o.list.shift();t.y=o.below+1,n.push(t),n.length===s.TOTAL_TILES&&(e.state="IDLE",n=[],e.isFadeIn=e.isFadeOut=!1)}}))})(e),e.isFadeOut&&(e=>{e.tFadeOut+=1,0===r(2,2,e.tFadeOut)&&(e.isFadeIn||e.fadeIn())})(e)}};t.default=l},27:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),o=a(555),i={render:e=>{const t=e.fall;(0,o.getKeys)(t).forEach((e=>{t[e].list.forEach((({x:e,y:t,value:a,offset:o})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET+o)}))}))},update:e=>{let t=!1;const a=e.fall;if((0,o.getKeys)(a).forEach((e=>{const o=a[e];e=Number(e);let i=!1;o.list.forEach(((t,a)=>{t.v+=s.GRAVITY,t.offset+=t.v;const n=t.y+Math.floor((t.offset+6)/s.CELL_SIZE);0===a?n>=o.below&&(i=!0,s.base.map[o.below][e]=t.value,o.below-=1):(t.offset>=o.list[a-1].offset-6||n>=o.below-a+1)&&(t.v=s.VELOCITY_BASE,t.offset=Math.floor(t.offset/s.CELL_SIZE)*s.CELL_SIZE)})),i&&o.list.shift(),o.list.length&&(t=!0)})),t)return;const i=[];for(let t=0;t<s.MAP_WIDTH;t+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const{matched:s,tiles:o}=e.matchPosition(a,t);s&&i.push(o)}i.length?(e.explodedTiles=(0,o.combine)(i),e.explosions=[],e.explodedTiles.forEach((t=>{const{x:a,y:o}=t;e.acquireTile(t),e.explosions.push({x:a,y:o,value:s.base.map[o][a]}),s.base.map[o][a]=-1})),e.state="EXPLODE"):(e.findAllMatchedPositions(),e.state="IDLE")}};t.default=i},879:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(131),o=a(876),i={render:e=>{const t=e.matchedPositions[e.hintIndex];if(!t)return;const{x0:a,y0:i,x1:n,y1:r}=t;let l="UP";n>a?l="RIGHT":n<a?l="LEFT":r>i&&(l="DOWN");const{texture:E,offset:c,drt:h}=s.hintArrows[l],d=o.hintArrowOffsets[e.tIdle%o.HINT_ARROW_CYCLE];o.base.context.drawImage(E,a*o.CELL_SIZE+c.x+h.x*d,i*o.CELL_SIZE+c.y+h.y*d)},update:e=>{e.tIdle+=1}};t.default=i},989:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const o=a(131),i=a(876),n=a(821),r=a(555),l=s(a(988)),E=s(a(613)),c=s(a(27)),h=s(a(879)),d=s(a(289)),I={IDLE:h.default,SELECT:d.default,EXPLODE:l.default,FALL:c.default,FADE:E.default};t.Game=class{state;selected;swapped;reswap;fall;explosions;explodedTiles;tIdle;tSelect;tSwap;tExplode;tExplode2;tFadeIn;tFadeOut;isFadeIn;isFadeOut;matchedPositions;hintIndex;players;playerTurn;constructor(){}init(){this.players=[new n.Player(this,0,5,100,i.PLAYER_INTELLIGENCE),new n.Player(this,1,10,100,40)],this.playerTurn=0,i.base.map=(0,r.generateMap)(),this.findAllMatchedPositions(),this.state="IDLE",this.selected=null,this.swapped=null,this.reswap=!1,this.fall={},this.explosions=[],this.tIdle=0,this.tSelect=0,this.tSwap=0,this.tExplode=0,this.tExplode2=0,this.tFadeIn=0,this.tFadeOut=0,this.isFadeIn=!1,this.isFadeOut=!1,this.hintIndex=0,this.fadeIn()}matchPosition(e,t){let a,s,o=[],n=[];const l=i.base.map[t][e],E=i.mapTileInfo[l].compatible;for(a=e-1;a>=0;){const e=i.base.map[t][a];if(!(0,r.check)(e,l,E))break;o.push({x:a,y:t,point:i.mapTileInfo[e].point,value:e}),a-=1}for(a=e+1;a<i.MAP_WIDTH;){const e=i.base.map[t][a];if(!(0,r.check)(e,l,E))break;o.push({x:a,y:t,point:i.mapTileInfo[e].point,value:e}),a+=1}for(s=t-1;s>=0;){const t=i.base.map[s][e];if(!(0,r.check)(t,l,E))break;n.push({x:e,y:s,point:i.mapTileInfo[t].point,value:t}),s-=1}for(s=t+1;s<i.MAP_WIDTH;){const t=i.base.map[s][e];if(!(0,r.check)(t,l,E))break;n.push({x:e,y:s,point:i.mapTileInfo[t].point,value:t}),s+=1}let c=!0,h=!0;o.length<2&&(o=[],c=!1),n.length<2&&(n=[],h=!1);const d=c||h,I=i.base.map[t][e],p=d?[...o,...n,{x:e,y:t,point:i.mapTileInfo[I].point,value:I}]:[];return{matched:d,tiles:p,point:p.reduce(((e,t)=>e+t.point),0)+(o.length>=i.GAIN_TURN?i.MATCH_4_POINT:0)+(n.length>=i.GAIN_TURN?i.MATCH_4_POINT:0),turn:Number(o.length>=i.GAIN_TURN)+Number(n.length>=i.GAIN_TURN)}}swap(e,t,a,s){const o=i.base.map[t][e];i.base.map[t][e]=i.base.map[s][a],i.base.map[s][a]=o}addMatchedPosition(e,t,a,s,o){this.swap(t,a,s,o);const{matched:i,point:n}=this.matchPosition(t,a),{matched:r,point:l}=this.matchPosition(s,o),E=Math.random()<.5?{x0:s,y0:o,x1:t,y1:a}:{x0:t,y0:a,x1:s,y1:o};(i||r)&&e.push({...E,point:n+l}),this.swap(t,a,s,o)}findAllMatchedPositions(){const e=[];for(let t=0;t<i.MAP_WIDTH_1;t+=1)for(let a=0;a<i.MAP_WIDTH_1;a+=1)this.addMatchedPosition(e,a,t,a+1,t),this.addMatchedPosition(e,a,t,a,t+1);for(let t=0;t<i.MAP_WIDTH_1;t+=1)this.addMatchedPosition(e,i.MAP_WIDTH_1,t,i.MAP_WIDTH_1,t+1);for(let t=0;t<i.MAP_WIDTH_1;t+=1)this.addMatchedPosition(e,t,i.MAP_WIDTH_1,t+1,i.MAP_WIDTH_1);e.sort(((e,t)=>e.point<t.point?1:-1)),this.matchedPositions=e,this.hintIndex=this.players[this.playerTurn].getHintIndex(this.matchedPositions.length)}onClick(e){if("IDLE"!==this.state&&"SELECT"!==this.state)return;const t=i.base.canvas,a=Math.floor(e.offsetX*t.width/t.clientWidth/i.CELL_SIZE),s=Math.floor(e.offsetY*t.height/t.clientHeight/i.CELL_SIZE);if(!(a<0||a>=i.MAP_WIDTH||s<0||s>=i.MAP_WIDTH)){if(this.tSwap=0,!this.selected)return this.selected={x:a,y:s,value:i.base.map[s][a]},i.base.map[s][a]=-1,void(this.state="SELECT");if(Math.abs(a-this.selected.x)+Math.abs(s-this.selected.y)!==1){const{x:e,y:t,value:a}=this.selected;return i.base.map[t][e]=a,this.selected=null,void(this.state="IDLE")}this.swapped={x:a,y:s,value:i.base.map[s][a]},i.base.map[s][a]=-1}}onKeyDown(e){"Escape"===e.key&&this.fadeOut()}fadeIn(){this.state="FADE";for(let e=0;e<i.MAP_WIDTH;e+=1)this.fall[e]={list:[],below:i.MAP_WIDTH_1,pushCount:0};this.tFadeIn=0,this.isFadeIn=!0}fadeOut(){this.state="FADE",this.tFadeOut=0,this.isFadeOut=!0}acquireTile({value:e}){switch(e){case i.TILES.MANA:this.players[this.playerTurn].acquireMana(5);break;case i.TILES.SWORD:this.players[1-this.playerTurn].takeDamage(2);break;case i.TILES.SWORDRED:this.players[1-this.playerTurn].takeDamage(3)}}render(){for(let e=0;e<i.MAP_WIDTH;e+=1)for(let t=0;t<i.MAP_WIDTH;t+=1){i.base.context.fillStyle=i.BOARD_COLORS[(e+t)%2];const a=t*i.CELL_SIZE,s=e*i.CELL_SIZE;i.base.context.fillRect(a,s,i.CELL_SIZE,i.CELL_SIZE),-1!==i.base.map[e][t]&&"FADE"!==this.state&&i.base.context.drawImage(i.mapTileInfo[i.base.map[e][t]].texture,a+i.TILE_OFFSET,s+i.TILE_OFFSET)}i.base.context.drawImage(o.menuTexture,0,i.BOARD_SIZE),this.players.forEach((e=>e.render())),I[this.state].render(this)}update(){this.players.forEach((e=>e.update())),I[this.state].update(this)}}},289:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(131),o=a(876),i=a(555),n={render:e=>{const t=e.tSwap*o.SWAP_OFFSET,{x:a,y:i,value:n}=e.selected,{x:r,y:l,value:E}=e.swapped||e.selected;if(e.swapped&&o.base.context.drawImage(o.mapTileInfo[E].texture,r*o.CELL_SIZE+o.TILE_OFFSET+(a-r)*t,l*o.CELL_SIZE+o.TILE_OFFSET+(i-l)*t),o.base.context.drawImage(o.mapTileInfo[n].texture,a*o.CELL_SIZE+o.TILE_OFFSET+(r-a)*t,i*o.CELL_SIZE+o.TILE_OFFSET+(l-i)*t),!e.swapped){const t=o.cornerSelectionOffsets[e.tSelect%o.CORNER_SELECTION_CYCLE];s.cornerSelections.forEach((({texture:a,offset:s,position:i})=>o.base.context.drawImage(a,e.selected.x*o.CELL_SIZE+i.x+s.x*t,e.selected.y*o.CELL_SIZE+i.y+s.y*t)))}},update:e=>{if(!e.swapped)return void(e.tSelect+=1);if(e.tSwap+=1,e.tSwap<=o.SWAP_DURATION)return;e.tSwap=o.SWAP_DURATION;const{x:t,y:a,value:s}=e.selected,{x:n,y:r,value:l}=e.swapped;if(o.base.map[a][t]=s,o.base.map[r][n]=l,e.swap(t,a,n,r),e.reswap)e.reswap=!1,e.selected=e.swapped=null,e.state="IDLE";else{const{matched:s,tiles:l}=e.matchPosition(t,a),{matched:E,tiles:c}=e.matchPosition(n,r);if(s||E)e.selected=e.swapped=null,e.explodedTiles=(0,i.combine)([l,c]),e.explosions=[],e.explodedTiles.forEach((t=>{const{x:a,y:s}=t;e.acquireTile(t),e.explosions.push({x:a,y:s,value:o.base.map[s][a]}),o.base.map[s][a]=-1})),e.state="EXPLODE";else{o.base.map[a][t]=-1,o.base.map[r][n]=-1;const s=e.selected.x,i=e.selected.y;e.selected.x=e.swapped.x,e.selected.y=e.swapped.y,e.swapped.x=s,e.swapped.y=i,e.reswap=!0,e.tSwap=0}}}};t.default=n},821:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;const s=a(131),o=a(876),i=a(555);t.Player=class{index;game;life;mana;energy;attack;intelligence;barOffsetX;bars;energyTimer;constructor(e,t,a,i,n){this.index=t,this.game=e,this.attack=a,this.life={maxValue:i,value:i,display:i,timer:0},this.energy={maxValue:o.DEFAULT_ENERGY,value:o.DEFAULT_ENERGY,display:o.DEFAULT_ENERGY,timer:0},this.mana={maxValue:o.DEFAULT_MANA,value:0,display:0,timer:0},this.bars=[{attribute:this.life,maxTimer:30,texture:s.barTextures.life},{attribute:this.energy,maxTimer:5,texture:s.barTextures.energy},{attribute:this.mana,maxTimer:5,texture:s.barTextures.mana}],this.intelligence=n,this.barOffsetX=0===t?132:o.SCREEN_WIDTH-132-s.barTextures.life.width,this.energyTimer=0}getHintIndex(e){const t=(0,i.random)(this.intelligence,101),a=Math.ceil((1-e)*t/100)+e-1;return console.log("Intelligence: ",this.intelligence),console.log("Chance: ",t),console.log("Length: ",e),console.log("Hint Index: ",a),a}takeDamage(e){this.life.timer=0,this.life.value=this.life.value-e}acquireEnergy(e){this.energy.timer=0,this.energy.value=this.energy.value+e}acquireMana(e){this.mana.timer=0,this.mana.value=this.mana.value+e}render(){this.bars.forEach((({texture:e,attribute:t},a)=>{const s=t.display/t.maxValue*84;s<1||o.base.context.drawImage(e,0,0,s,12,this.barOffsetX,o.BOARD_SIZE+26+18*a,s,12)}))}update(){this.index===this.game.playerTurn&&(this.energyTimer+=1,this.energyTimer%o.LOSE_ENERGY_INTERVAL==0&&(this.energy.value-=1)),this.bars.forEach((({attribute:e,maxTimer:t})=>{if(e.display<=e.value)return;e.timer+=1,e.timer>t&&(e.timer=t);let a=-e.timer/t+1;a=2*a-1,a=(Math.cbrt(a)+1)/2,e.display=e.value+(e.display-e.value)*a}))}}},451:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resize=t.rotateCW90=t.flipVertical=t.flipHorizontal=void 0,t.flipHorizontal=e=>{const t=e.width,a=e.height,s=document.createElement("canvas");s.width=t,s.height=a;const o=s.getContext("2d");return o.translate(t,0),o.scale(-1,1),o.drawImage(e,0,0),(e=new Image).src=s.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.flipVertical=e=>{const t=e.width,a=e.height,s=document.createElement("canvas");s.width=t,s.height=a;const o=s.getContext("2d");return o.translate(0,0),o.scale(1,-1),o.drawImage(e,0,-e.height),(e=new Image).src=s.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.rotateCW90=e=>{const t=document.createElement("canvas");t.width=e.height,t.height=e.width;const a=t.width,s=t.height,o=t.getContext("2d");return o.translate(a,s/a),o.rotate(Math.PI/2),o.drawImage(e,0,0),(e=new Image).src=t.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.resize=(e,t=1)=>{const a=Math.floor(e.width*t),s=Math.floor(e.height*t),o=document.createElement("canvas");o.width=a,o.height=s;const i=o.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(e,0,0,a,s);const n=new Image;return n.src=o.toDataURL("image/png"),new Promise((e=>{n.onload=()=>e(n)}))}},555:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.combine=t.getKey=t.findBelow=t.check=t.generateMap=t.randomTile=t.random=t.getImageSrc=t.getKeys=t.getAppName=void 0;const s=a(876);t.getAppName=()=>s.APP_NAME,t.getKeys=Object.keys,t.getImageSrc=(e,t="png")=>`/static/images/${e}.${t}`,t.random=(e,t)=>Math.floor(Math.random()*(t-e))+e;let o=0;const i=Array.from({length:s.COUNT_TILES}).map(((e,t)=>{const a=s.mapTileInfo[t].probability;return o+=a,o}));t.randomTile=()=>{const e=(0,t.random)(0,o);for(let t=0;t<s.COUNT_TILES;t+=1)if(e<=i[t])return t;return-1},t.generateMap=()=>{const e=Array.from({length:s.MAP_WIDTH}).map((()=>Array.from({length:s.MAP_WIDTH}).map(t.randomTile))),a=(t,a,s,o)=>{const i=e[a][t];return i===s||o.includes(i)},o=(t,o)=>{let i=0,n=0;const r=e[o][t],l=s.mapTileInfo[r].compatible;let E=t+1;for(;E<s.MAP_WIDTH&&a(E,o,r,l);)i+=1,E+=1;if(i>=2)return!0;let c=o+1;for(;c<s.MAP_WIDTH&&a(t,c,r,l);)n+=1,c+=1;return n>=2};let i=!0;for(;i;){i=!1;for(let a=0;a<s.MAP_WIDTH;a+=1)for(let n=0;n<s.MAP_WIDTH;n+=1)o(n,a)&&(i=!0,e[a][n]=(0,t.randomTile)())}return e},t.check=(e,t,a)=>e===t||a.includes(e),t.findBelow=e=>e.reduce(((e,t)=>e<t.y?t.y:e),-1),t.getKey=(e,t)=>t*s.MAP_WIDTH+e;const n=[{x:0,y:-1,condition:(e,t)=>t>=1},{x:1,y:-1,condition:(e,t)=>e<s.MAP_WIDTH_1&&t>=1},{x:1,y:0,condition:(e,t)=>e<s.MAP_WIDTH_1},{x:1,y:1,condition:(e,t)=>e<s.MAP_WIDTH_1&&t<s.MAP_WIDTH_1},{x:0,y:1,condition:(e,t)=>t<s.MAP_WIDTH_1},{x:-1,y:1,condition:(e,t)=>e>=1&&t<s.MAP_WIDTH_1},{x:-1,y:0,condition:(e,t)=>e>=1},{x:-1,y:-1,condition:(e,t)=>e>=1&&t>=1}];t.combine=e=>{const a=[],o={};e.forEach((e=>{e.forEach((e=>{const{x:s,y:i}=e,n=(0,t.getKey)(s,i);o[n]||(o[n]=!0,a.push(e))}))}));const i=[];return a.forEach((({x:e,y:a,value:r})=>{r===s.TILES.SWORDRED&&n.forEach((({x:n,y:r,condition:l})=>{if(!l(e,a))return;const E=e+n,c=a+r,h=(0,t.getKey)(E,c);o[h]||(o[h]=!0,i.push({x:E,y:c,point:0,value:s.base.map[c][E]}))}))})),a.push(...i),a}},774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=void 0,t.clamp=(e,t,a)=>e<t?t:e>a?a:e}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,a),i.exports}(()=>{const e=a(131),t=a(876),s=new(a(989).Game),o=(e=0)=>{requestAnimationFrame(o),s.update(),s.render()};(async()=>{(()=>{const e=document.getElementById("canvas"),a=e.getContext("2d");e.width=t.SCREEN_WIDTH,e.height=t.SCREEN_HEIGHT,a.imageSmoothingEnabled=!1,t.base.canvas=e,t.base.context=a})(),await(0,e.loadTextures)(),s.init(),t.base.canvas.addEventListener("click",(e=>{s.onClick(e)})),document.addEventListener("keydown",(e=>{s.onKeyDown(e)})),o()})()})()})();
//# sourceMappingURL=index.js.map