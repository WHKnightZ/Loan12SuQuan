(()=>{"use strict";var t={131:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.loadTextures=e.starTextures=e.mapFontChar=e.avatarTextures=e.barTextures=e.menuTexture=e.hintArrows=e.cornerSelections=void 0;const s=a(876),i=a(451),o=a(555),n=t=>{const e=new Image;return e.src=(0,o.getImageSrc)(t),new Promise((t=>e.onload=()=>t(e)))},r=async()=>{await Promise.all((0,o.getKeys)(s.TILES).map((t=>((t,e)=>{const a=new Image;return a.src=(0,o.getImageSrc)(`tiles/${e}`),new Promise((e=>a.onload=async()=>{const i=t=>{const e=Math.floor(a.width/s.TILE_LENGTH*s.SCALE_RATIO),i=Math.floor(a.height*s.SCALE_RATIO),o=document.createElement("canvas");o.width=e,o.height=i;const n=o.getContext("2d");n.imageSmoothingEnabled=!1;const r=a.width/s.TILE_LENGTH*t,l=a.width/s.TILE_LENGTH;n.drawImage(a,r,0,l,a.height,0,0,e,i);const h=new Image;return h.src=o.toDataURL("image/png"),new Promise((t=>h.onload=()=>t(h)))};s.mapTileInfo[t].texture=await i(0),s.mapTileInfo[t].explosions=[];for(let e=0;e<6;e+=1)s.mapTileInfo[t].explosions[e]=await i(e+1);e(null)}))})(s.TILES[t],t.toLowerCase()))))};e.cornerSelections=[];const l=()=>{e.cornerSelections=[];let t=new Image;return t.src=(0,o.getImageSrc)("selection/corner"),new Promise((a=>{t.onload=async()=>{const o=await(0,i.flipHorizontal)(t),n=await(0,i.flipVertical)(t),r=await(0,i.flipVertical)(o),l=t.width,h=s.CELL_SIZE-l;e.cornerSelections.push({texture:t,position:{x:0,y:0},offset:{x:1,y:1}}),e.cornerSelections.push({texture:o,position:{x:h,y:0},offset:{x:-1,y:1}}),e.cornerSelections.push({texture:n,position:{x:0,y:h},offset:{x:1,y:-1}}),e.cornerSelections.push({texture:r,position:{x:h,y:h},offset:{x:-1,y:-1}}),a(null)}}))};e.hintArrows={};const h=async()=>{let t=new Image;t.src=(0,o.getImageSrc)("common/hint-arrow"),await new Promise((e=>t.onload=async()=>{t=await(0,i.resize)(t,2),e(null)})),e.hintArrows.UP={offset:{x:(s.CELL_SIZE-t.width)/2,y:-6},texture:t,drt:{x:0,y:-1}},t=await(0,i.rotateCW90)(t),e.hintArrows.RIGHT={offset:{x:s.CELL_SIZE-t.width+6,y:(s.CELL_SIZE-t.height)/2},texture:t,drt:{x:1,y:0}},t=await(0,i.rotateCW90)(t),e.hintArrows.DOWN={offset:{x:(s.CELL_SIZE-t.width)/2,y:s.CELL_SIZE-t.height+6},texture:t,drt:{x:0,y:1}},t=await(0,i.rotateCW90)(t),e.hintArrows.LEFT={offset:{x:-6,y:(s.CELL_SIZE-t.height)/2},texture:t,drt:{x:-1,y:0}}};e.menuTexture=null,e.barTextures={};const c=async()=>{e.menuTexture=await n("common/menu"),e.menuTexture=await(0,i.resize)(e.menuTexture,2);const t=["life","energy","mana"];let a=await Promise.all(t.map((t=>n(`common/${t}bar`))));a=await Promise.all(a.map((t=>(0,i.resize)(t,2)))),a.forEach(((a,s)=>{e.barTextures[t[s]]=a}))};e.avatarTextures=Array.from({length:2}).map((()=>[null,null]));const d=async()=>(await Promise.all(e.avatarTextures.map(((t,a)=>new Promise((t=>{n(`avatars/${a}`).then((t=>(0,i.resize)(t,2))).then((s=>{e.avatarTextures[a][1]=s,t(null)}))}))))),Promise.all(e.avatarTextures.map((t=>new Promise((e=>{(0,i.flipHorizontal)(t[1]).then((a=>{t[0]=a,e(null)}))}))))));e.mapFontChar={};const u=async()=>{const t=await n("fonts/fontcap"),a=[0,2,10,16,24,32,40,48,56,64,72,80,84,88,92,80,0,6,12,87,19,26,32,41,49,62,67,92,78,12,96,86,32,49,58,66,74,83,41,92,0,20,8,14,29,48,55,65,37,73,81,90,0,20,7,28,46,57,65,36,90,15,73,0,24,43,52,61,33,82,91,9,70,0,18,42,51,60,28,35,79,9,67,86,93,0,16,42,60,23,29,35,49,74,83,0,9,49,58,18,27,36,67,76,85,0,46,11,22,33,92,57,85,65,73,0,44,33,54,10,20,81,89,64,72,0],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,9,9,9,7,9,9,9,9,9,9,9,9,15,16,0,17,18,18,18,19,20,20,20,20,21,21,24,24,27,27,27,28,29,29,29,29,30,30,33,36,36,36,37,38,38,39,40,42,45,45,45,46,47,50,50,51,52,54,56,57,57,58,59,59,62,63,64,64,64,66,68,69,70,71,71,71,71,74,76,78,80,82,82,83,83,83,86,88,88,92,93,95,95,95,76,94,97,98,102,104,105,106,106,107,107,109,109,110,113,114],i=[2,8,6,8,8,8,8,8,8,8,8,4,4,4,4,7,6,6,7,5,7,6,9,8,13,5,11,8,8,8,4,8,9,9,8,8,9,9,7,7,8,9,6,6,8,7,10,8,9,8,9,8,7,8,8,8,11,8,8,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,7,7,7,7,7,7,7,7,9,7,7,6,6,6,6,6,9,9,9,9,9,9,9,9,10,9,9,11,11,11,11,11,11,8,8,8,8,8,10,10,10,10,10,10,8,8,8,8,8],o=[1,9,9,9,9,9,9,9,9,9,9,4,6,7,9,9,12,12,7,3,7,12,9,11,9,5,10,8,5,8,9,3,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,12,12,12,11,12,12,12,12,12,14,12,12,12,12,12,14,12,12,12,12,11,12,12,12,12,12,14,12,12,12,12,11,12,12,12,12,11,12,12,12,12,12,14,9,12,12,12,12,11,12,12,12,12,11,10,12,12,12,12,12,12,12,12,12,11],r=[11,3,3,3,3,3,3,3,3,3,3,8,8,5,3,3,2,2,4,6,2,2,3,2,3,2,3,4,5,4,5,11,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,2,0,0,0,0,2,0,0,0,0,3],l=[];for(let n=0;n<126;n+=1){const h=' 0123456789.,:!?()+-*/#$%"@<=>;_&ABCDĐEFGHIJKLMNOPQRSTUVWXYZÁÀẢÃẠĂẮẰẲẴẶÂẤẦẨẪẬÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌÔỐỒỔỖỘƠỚỜỞỠỢÚÙỦŨỤƯỨỪỬỮỰÝỲỶỸỴ'.charAt(n),c=Math.floor(2*i[n]),d=Math.floor(2*o[n]),u=document.createElement("canvas");u.width=c,u.height=d;const p=u.getContext("2d");p.imageSmoothingEnabled=!1,p.drawImage(t,a[n],s[n],i[n],o[n],0,0,c,d);const E=new Image;E.src=u.toDataURL("image/png"),l.push(new Promise((t=>E.onload=()=>{e.mapFontChar[h]={texture:E,offsetY:Math.floor(2*r[n])},t(null)})))}return Promise.all(l)};e.starTextures=[];const p=async()=>{const t=await n("common/star");e.starTextures[0]=await(0,i.resize)(t,2);const a=[],s=e.starTextures[0];return a.push((0,i.rotateCW90)(s).then((t=>e.starTextures[1]=t))),a.push((0,i.rotate180)(s).then((t=>e.starTextures[2]=t))),a.push((0,i.rotateCCW90)(s).then((t=>e.starTextures[3]=t))),Promise.all(a)};e.loadTextures=()=>Promise.all([r(),l(),h(),c(),d(),u(),p()])},876:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.hintArrowOffsets=e.cornerSelectionOffsets=e.base=e.mapTileInfo=e.COUNT_TILES=e.TILES=e.TIMER_HINT_DELAY_DEFAULT=e.LOSE_ENERGY_INTERVAL=e.OPACITY_ZERO=e.DEFAULT_ENERGY=e.DEFAULT_MANA=e.PLAYER_INTELLIGENCE=e.HINT_ARROW_CYCLE=e.CORNER_SELECTION_CYCLE=e.SCALE_RATIO=e.GRAVITY=e.VELOCITY_BASE=e.SWAP_OFFSET=e.SWAP_DURATION=e.MATCH_4_POINT=e.GAIN_TURN=e.TILE_OFFSET=e.TILE_LENGTH=e.REAL_TILE_SIZE=e.TILE_SIZE=e.SCREEN_HEIGHT=e.SCREEN_WIDTH=e.MENU_HEIGHT=e.BOARD_SIZE=e.CELL_SIZE=e.TOTAL_TILES=e.MAP_WIDTH_1=e.MAP_WIDTH=e.BOARD_COLORS=e.APP_NAME=void 0,e.APP_NAME="Loạn 12 Sứ Quân",e.BOARD_COLORS=["#3e3226","#554933"],e.MAP_WIDTH=8,e.MAP_WIDTH_1=e.MAP_WIDTH-1,e.TOTAL_TILES=e.MAP_WIDTH*e.MAP_WIDTH,e.CELL_SIZE=60,e.BOARD_SIZE=e.MAP_WIDTH*e.CELL_SIZE,e.MENU_HEIGHT=96,e.SCREEN_WIDTH=e.BOARD_SIZE,e.SCREEN_HEIGHT=e.BOARD_SIZE+e.MENU_HEIGHT,e.TILE_SIZE=50,e.REAL_TILE_SIZE=28,e.TILE_LENGTH=7,e.TILE_OFFSET=Math.floor((e.CELL_SIZE-e.TILE_SIZE)/2),e.GAIN_TURN=3,e.MATCH_4_POINT=50,e.SWAP_DURATION=10,e.SWAP_OFFSET=e.CELL_SIZE/e.SWAP_DURATION,e.VELOCITY_BASE=3.5,e.GRAVITY=.27,e.SCALE_RATIO=e.TILE_SIZE/e.REAL_TILE_SIZE,e.CORNER_SELECTION_CYCLE=30,e.HINT_ARROW_CYCLE=30,e.PLAYER_INTELLIGENCE=20,e.DEFAULT_MANA=72,e.DEFAULT_ENERGY=100,e.OPACITY_ZERO=1e-4,e.LOSE_ENERGY_INTERVAL=300,e.TIMER_HINT_DELAY_DEFAULT=300,e.TILES={SWORD:0,HEART:1,GOLD:2,ENERGY:3,MANA:4,EXP:5,SWORDRED:6},e.COUNT_TILES=Object.keys(e.TILES).length,e.mapTileInfo={[e.TILES.SWORD]:{compatible:[e.TILES.SWORDRED],probability:90,point:10,texture:null,explosions:[]},[e.TILES.HEART]:{compatible:[],probability:100,point:9,texture:null,explosions:[]},[e.TILES.GOLD]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[e.TILES.ENERGY]:{compatible:[],probability:100,point:7,texture:null,explosions:[]},[e.TILES.MANA]:{compatible:[],probability:100,point:8,texture:null,explosions:[]},[e.TILES.EXP]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[e.TILES.SWORDRED]:{compatible:[e.TILES.SWORD],probability:10,point:30,texture:null,explosions:[]}},e.base={},e.cornerSelectionOffsets=Array.from({length:e.CORNER_SELECTION_CYCLE}).map(((t,a)=>Math.floor(3*Math.sin(2*Math.PI*a/e.CORNER_SELECTION_CYCLE)))),e.hintArrowOffsets=Array.from({length:e.HINT_ARROW_CYCLE}).map(((t,a)=>Math.floor(3*Math.sin(2*Math.PI*a/e.HINT_ARROW_CYCLE))))},288:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Effect=void 0,e.Effect=class{isAlive;x;y;timer;opacity;constructor(t,e){this.timer=0,this.isAlive=!0,this.opacity=1,this.x=t,this.y=e}render(){}update(){}}},813:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FlickeringText=void 0;const s=a(876),i=a(457),o=a(288);class n extends o.Effect{text;show;speed;constructor({text:t,x:e=0,y:a=0}){super(e,a),this.text=t,this.show=!0,this.speed=8}render(){this.show&&(s.base.context.save(),s.base.context.globalAlpha=this.opacity,i.font.draw({text:this.text,x:this.x,y:this.y}),s.base.context.restore())}update(){this.timer+=1,this.opacity-=.012,this.timer%Math.floor(this.speed)==0&&(this.timer=0,this.speed-=.01,this.show=!this.show),this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1)}}e.FlickeringText=n},639:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FloatingText=void 0;const s=a(876),i=a(457),o=a(288);class n extends o.Effect{text;isFadeIn;constructor({text:t,x:e=0,y:a=0}){super(e,a),this.text=t,this.isFadeIn=!0,this.opacity=0}render(){s.base.context.save(),s.base.context.globalAlpha=this.opacity,i.font.draw({text:this.text,x:this.x,y:this.y}),s.base.context.restore()}update(){this.y-=.8,this.isFadeIn?(this.opacity+=.12,this.opacity>1&&(this.isFadeIn=!1,this.opacity=1)):(this.opacity-=.04,this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1))}}e.FloatingText=n},827:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.effects=e.Effects=void 0;class a{list;constructor(){this.list=[]}render(){this.list.forEach((t=>t.render()))}update(){let t=!1;this.list.forEach((e=>{e.update(),t=t||!e.isAlive})),t&&(this.list=this.list.filter((t=>t.isAlive)))}add(t){this.list.push(t)}}e.Effects=a,e.effects=new a},170:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StarExplosion=void 0;const s=a(876),i=a(450),o=a(288);class n extends o.Effect{list;constructor(t,e){super(t,e),this.list=[];for(let a=0;a<20;a+=1){const s=2*Math.PI*a/20;this.list.push(new i.Star(t,e,4*Math.cos(s),4*Math.sin(s)))}}render(){s.base.context.save(),s.base.context.globalAlpha=this.opacity,this.list.forEach((t=>t.render())),s.base.context.restore()}update(){this.opacity-=.025,this.list.forEach((t=>t.update())),this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1)}}e.StarExplosion=n},988:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=a(876),i=a(555),o={render:t=>{t.explosions.forEach((({x:e,y:a,value:i})=>{const o=s.mapTileInfo[i].explosions[t.tExplode];s.base.context.drawImage(o,e*s.CELL_SIZE+Math.floor((s.CELL_SIZE-o.width)/2),a*s.CELL_SIZE+Math.floor((s.CELL_SIZE-o.height)/2))}))},update:t=>{if(t.tExplode2+=1,t.tExplode2%2!=0)return;if(t.tExplode+=1,4!==t.tExplode)return;t.tExplode=0,t.state="FALL",t.fall={};const e=t.fall;t.explodedTiles.forEach((({x:a,y:i})=>{s.base.map[i][a]=-1,t.fall[a]?!e[a].list.find((({x:t,y:e})=>t===a&&e===i))&&e[a].list.push({x:a,y:i,v:0,offset:0,value:-1}):e[a]={list:[{x:a,y:i,v:0,offset:0,value:-1}],below:-1}})),(0,i.getKeys)(e).forEach((a=>{e[a].below=(0,i.findBelow)(e[a].list);const o=e[a].list.length;e[a].list=[],a=Number(a);for(let i=t.fall[a].below;i>=0;i-=1)-1!==s.base.map[i][a]&&(e[a].list.push({x:a,y:i,v:s.VELOCITY_BASE,offset:0,value:s.base.map[i][a]}),s.base.map[i][a]=-1);for(let t=0;t<o;t+=1)e[a].list.push({x:a,y:-1-t,v:s.VELOCITY_BASE,offset:0,value:(0,i.randomTile)()})}))}};e.default=o},613:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=a(876),i=a(555),o=a(774);let n=[];const r=(t,e,a)=>(0,o.clamp)(3*(t+e+1)+7-a,0,10)/10,l={render:t=>{t.isFadeIn&&(t=>{const e=t.fall;(0,i.getKeys)(e).forEach((t=>{e[t].list.forEach((({x:t,y:e,value:a,offset:i})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,t*s.CELL_SIZE+s.TILE_OFFSET,e*s.CELL_SIZE+s.TILE_OFFSET+i)}))})),n.forEach((({x:t,y:e,value:a})=>s.base.context.drawImage(s.mapTileInfo[a].texture,t*s.CELL_SIZE+s.TILE_OFFSET,e*s.CELL_SIZE+s.TILE_OFFSET)))})(t),t.isFadeOut&&(t=>{for(let e=0;e<s.MAP_WIDTH;e+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const i=a*s.CELL_SIZE,o=e*s.CELL_SIZE,n=r(a,e,t.tFadeOut),l=Math.floor(s.TILE_SIZE*n),h=Math.floor((s.CELL_SIZE-l)/2);0!==l&&s.base.context.drawImage(s.mapTileInfo[s.base.map[e][a]].texture,i+h,o+h,l,l)}})(t)},update:t=>{t.isFadeIn&&(t=>{t.tFadeIn+=1;const e=t.fall;for(let a=0;a<s.MAP_WIDTH;a+=1){let i=t.tFadeIn-3*a;i<1&&(i=1),i%6==0&&e[a].pushCount<s.MAP_WIDTH&&(e[a].list.push({x:a,y:-1,v:s.VELOCITY_BASE+4,offset:0,value:s.base.map[s.MAP_WIDTH_1-e[a].pushCount][a]}),e[a].pushCount+=1)}(0,i.getKeys)(e).forEach((a=>{const i=e[a];a=Number(a);let o=!1;if(i.list.forEach(((t,e)=>{t.v+=1.4*s.GRAVITY,t.offset+=t.v;const a=t.y+Math.floor((t.offset+6)/s.CELL_SIZE);0===e?a>=i.below&&(o=!0,i.below-=1):(t.offset>=i.list[e-1].offset-6||a>=i.below-e+1)&&(t.v=s.VELOCITY_BASE,t.offset=Math.floor(t.offset/s.CELL_SIZE)*s.CELL_SIZE)})),o){const e=i.list.shift();e.y=i.below+1,n.push(e),n.length===s.TOTAL_TILES&&(t.idle(),n=[],t.isFadeIn=t.isFadeOut=!1)}}))})(t),t.isFadeOut&&(t=>{t.tFadeOut+=1,0===r(2,2,t.tFadeOut)&&(t.isFadeIn||t.fadeIn())})(t)}};e.default=l},27:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=a(876),i=a(555),o={render:t=>{const e=t.fall;(0,i.getKeys)(e).forEach((t=>{e[t].list.forEach((({x:t,y:e,value:a,offset:i})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,t*s.CELL_SIZE+s.TILE_OFFSET,e*s.CELL_SIZE+s.TILE_OFFSET+i)}))}))},update:t=>{let e=!1;const a=t.fall;if((0,i.getKeys)(a).forEach((t=>{const i=a[t];t=Number(t);let o=!1;i.list.forEach(((e,a)=>{e.v+=s.GRAVITY,e.offset+=e.v;const n=e.y+Math.floor((e.offset+6)/s.CELL_SIZE);0===a?n>=i.below&&(o=!0,s.base.map[i.below][t]=e.value,i.below-=1):(e.offset>=i.list[a-1].offset-6||n>=i.below-a+1)&&(e.v=s.VELOCITY_BASE,e.offset=Math.floor(e.offset/s.CELL_SIZE)*s.CELL_SIZE)})),o&&i.list.shift(),i.list.length&&(e=!0)})),e)return;t.matched4={turnCount:0,matchedList:{}},t.matched4Tiles=[];const o=[];for(let e=0;e<s.MAP_WIDTH;e+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const{matched:s,tiles:i,matched4Tiles:n}=t.matchPosition(a,e);s&&o.push(i),n.length&&(t.matched4Tiles=t.matched4Tiles.concat(n))}o.length?(t.explodedTiles=(0,i.combine)(o),t.explosions=[],t.explodedTiles.forEach((e=>{const{x:a,y:i}=e;t.gainTile(e),t.explosions.push({x:a,y:i,value:s.base.map[i][a]})})),t.explode()):(t.findAllMatchedPositions(),t.idle())}};e.default=o},879:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=a(131),i=a(876),o={render:t=>{if(t.tHintDelay>0)return;const e=t.matchedPositions[t.hintIndex];if(!e)return;const{x0:a,y0:o,x1:n,y1:r}=e;let l="UP";n>a?l="RIGHT":n<a?l="LEFT":r>o&&(l="DOWN");const{texture:h,offset:c,drt:d}=s.hintArrows[l],u=i.hintArrowOffsets[t.tIdle%i.HINT_ARROW_CYCLE];i.base.context.drawImage(h,a*i.CELL_SIZE+c.x+d.x*u,o*i.CELL_SIZE+c.y+d.y*u)},update:t=>{t.tHintDelay>0?t.tHintDelay-=1:t.tIdle+=1}};e.default=o},989:function(t,e,a){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;const i=a(131),o=a(876),n=a(827),r=a(813),l=a(639),h=a(170),c=a(821),d=a(555),u=s(a(988)),p=s(a(613)),E=s(a(27)),f=s(a(879)),m=s(a(289)),T=s(a(554)),I={IDLE:f.default,SELECT:m.default,EXPLODE:u.default,FALL:E.default,FADE:p.default,WAIT:T.default};e.Game=class{state;selected;swapped;reswap;fall;combo;explosions;explodedTiles;matched4Tiles;matched4;tIdle;tSelect;tSwap;tExplode;tExplode2;tFadeIn;tFadeOut;tHintDelay;isFadeIn;isFadeOut;wait;matchedPositions;hintIndex;players;playerTurn;turnCount;needUpdate;computerTimer;constructor(){}init(){this.players=[new c.Player({game:this,index:0,attack:7,life:100,intelligence:o.PLAYER_INTELLIGENCE,avatar:0}),new c.Player({game:this,index:1,attack:9,life:100,intelligence:100,avatar:1})],this.playerTurn=0,this.turnCount=1,this.matched4={turnCount:0,matchedList:{}},o.base.map=(0,d.generateMap)(),this.findAllMatchedPositions(),this.state="IDLE",this.selected=null,this.swapped=null,this.reswap=!1,this.fall={},this.combo=0,this.explosions=[],this.tIdle=0,this.tSelect=0,this.tSwap=0,this.tExplode=0,this.tExplode2=0,this.tFadeIn=0,this.tFadeOut=0,this.isFadeIn=!1,this.isFadeOut=!1,this.hintIndex=0,this.needUpdate=!0,this.fadeIn()}matchPosition(t,e){let a,s,i=[],n=[];const r=o.base.map[e][t],l=o.mapTileInfo[r].compatible;for(a=t-1;a>=0;){const t=o.base.map[e][a];if(!(0,d.check)(t,r,l))break;i.push({x:a,y:e,point:o.mapTileInfo[t].point,value:t}),a-=1}for(a=t+1;a<o.MAP_WIDTH;){const t=o.base.map[e][a];if(!(0,d.check)(t,r,l))break;i.push({x:a,y:e,point:o.mapTileInfo[t].point,value:t}),a+=1}for(s=e-1;s>=0;){const e=o.base.map[s][t];if(!(0,d.check)(e,r,l))break;n.push({x:t,y:s,point:o.mapTileInfo[e].point,value:e}),s-=1}for(s=e+1;s<o.MAP_WIDTH;){const e=o.base.map[s][t];if(!(0,d.check)(e,r,l))break;n.push({x:t,y:s,point:o.mapTileInfo[e].point,value:e}),s+=1}let h=!0,c=!0;i.length<2&&(i=[],h=!1),n.length<2&&(n=[],c=!1);const u=h||c,p=o.base.map[e][t],E={x:t,y:e,point:o.mapTileInfo[p].point,value:p},f=u?[...i,...n,E]:[],m=t=>{let e=0;return t.forEach((t=>{const a=(0,d.getKey)(t.x,t.y);this.matched4.matchedList[a]||(this.matched4.matchedList[a]=!0,e=1)})),e};let T=[];return i.length>=o.GAIN_TURN&&(T=T.concat(i),this.matched4.turnCount+=m([...i,E])),n.length>=o.GAIN_TURN&&(T=T.concat(n),this.matched4.turnCount+=m([...n,E])),T.length&&T.push(E),{matched:u,tiles:f,point:f.reduce(((t,e)=>t+e.point),0)+(i.length>=o.GAIN_TURN?o.MATCH_4_POINT:0)+(n.length>=o.GAIN_TURN?o.MATCH_4_POINT:0),matched4Tiles:T}}swap(t,e,a,s){const i=o.base.map[e][t];o.base.map[e][t]=o.base.map[s][a],o.base.map[s][a]=i}addMatchedPosition(t,e,a,s,i){this.swap(e,a,s,i);const{matched:o,point:n}=this.matchPosition(e,a),{matched:r,point:l}=this.matchPosition(s,i),h=Math.random()<.5?{x0:s,y0:i,x1:e,y1:a}:{x0:e,y0:a,x1:s,y1:i};(o||r)&&t.push({...h,point:n+l}),this.swap(e,a,s,i)}findAllMatchedPositions(){const t=[];for(let e=0;e<o.MAP_WIDTH_1;e+=1)for(let a=0;a<o.MAP_WIDTH_1;a+=1)this.addMatchedPosition(t,a,e,a+1,e),this.addMatchedPosition(t,a,e,a,e+1);for(let e=0;e<o.MAP_WIDTH_1;e+=1)this.addMatchedPosition(t,o.MAP_WIDTH_1,e,o.MAP_WIDTH_1,e+1);for(let e=0;e<o.MAP_WIDTH_1;e+=1)this.addMatchedPosition(t,e,o.MAP_WIDTH_1,e+1,o.MAP_WIDTH_1);t.sort(((t,e)=>t.point<e.point?1:-1)),this.matchedPositions=t}onClick(t){if("IDLE"!==this.state&&"SELECT"!==this.state||0!==this.playerTurn)return;const e=o.base.canvas,a=Math.floor(t.offsetX*e.width/e.clientWidth/o.CELL_SIZE),s=Math.floor(t.offsetY*e.height/e.clientHeight/o.CELL_SIZE);if(!(a<0||a>=o.BOARD_SIZE||s<0||s>=o.BOARD_SIZE)){if(this.tSwap=0,!this.selected)return this.selected={x:a,y:s,value:o.base.map[s][a]},o.base.map[s][a]=-1,void(this.state="SELECT");if(Math.abs(a-this.selected.x)+Math.abs(s-this.selected.y)!==1){const{x:t,y:e,value:a}=this.selected;return o.base.map[e][t]=a,this.selected=null,void this.idle()}this.swapped={x:a,y:s,value:o.base.map[s][a]},o.base.map[s][a]=-1}}onKeyDown(t){"Escape"===t.key&&this.fadeOut()}changePlayer(){this.playerTurn=1-this.playerTurn,this.turnCount=1}idle(){this.tHintDelay=o.TIMER_HINT_DELAY_DEFAULT,this.state="IDLE",this.combo=0,this.needUpdate&&(this.turnCount>1?n.effects.add(new r.FlickeringText({text:`Còn ${this.turnCount} lượt`})):0===this.turnCount&&this.changePlayer()),this.hintIndex=this.players[this.playerTurn].getHintIndex(this.matchedPositions.length),1===this.playerTurn&&(this.computerTimer=0),this.needUpdate=!1}explode(){this.wait={timer:0,maxTimer:0===this.combo?4:8,callback:()=>{this.explosions.forEach((({x:t,y:e})=>o.base.map[e][t]=-1)),this.state="EXPLODE";const t=this.explosions.reduce(((t,e)=>({x:t.x+e.x,y:t.y+e.y})),{x:0,y:0});this.turnCount+=this.matched4.turnCount;const e=t.x/this.explosions.length,a=t.y/this.explosions.length;this.combo+=1;const s=e*o.CELL_SIZE+o.CELL_SIZE/2,i=a*o.CELL_SIZE+o.CELL_SIZE/2;this.combo<2||(n.effects.add(new l.FloatingText({text:`x${this.combo}`,x:s,y:i+8})),n.effects.add(new h.StarExplosion(s,i)))}},this.state="WAIT"}fadeIn(){this.state="FADE";for(let t=0;t<o.MAP_WIDTH;t+=1)this.fall[t]={list:[],below:o.MAP_WIDTH_1,pushCount:0};this.tFadeIn=0,this.isFadeIn=!0}fadeOut(){this.state="FADE",this.tFadeOut=0,this.isFadeOut=!0}gainTile({value:t}){switch(t){case o.TILES.SWORD:case o.TILES.SWORDRED:const e=this.players[this.playerTurn].attack/4;this.players[1-this.playerTurn].takeDamage(e*(t===o.TILES.SWORDRED?2.5:1));break;case o.TILES.HEART:this.players[this.playerTurn].gainLife(1.5);break;case o.TILES.GOLD:break;case o.TILES.ENERGY:this.players[this.playerTurn].gainEnergy(2);break;case o.TILES.MANA:this.players[this.playerTurn].gainMana(5);case o.TILES.EXP:}}updateComputer(){if(1===this.playerTurn)if(this.computerTimer+=1,70===this.computerTimer){this.tSwap=0;const{x0:t,y0:e}=this.matchedPositions[this.hintIndex];this.selected={x:t,y:e,value:o.base.map[e][t]},o.base.map[e][t]=-1,this.state="SELECT"}else if(100===this.computerTimer){const{x1:t,y1:e}=this.matchedPositions[this.hintIndex];this.swapped={x:t,y:e,value:o.base.map[e][t]},o.base.map[e][t]=-1}}render(){for(let t=0;t<o.MAP_WIDTH;t+=1)for(let e=0;e<o.MAP_WIDTH;e+=1){o.base.context.fillStyle=o.BOARD_COLORS[(t+e)%2];const a=e*o.CELL_SIZE,s=t*o.CELL_SIZE;o.base.context.fillRect(a,s,o.CELL_SIZE,o.CELL_SIZE),-1!==o.base.map[t][e]&&"FADE"!==this.state&&o.base.context.drawImage(o.mapTileInfo[o.base.map[t][e]].texture,a+o.TILE_OFFSET,s+o.TILE_OFFSET)}o.base.context.drawImage(i.menuTexture,0,o.BOARD_SIZE),this.players.forEach((t=>t.render())),I[this.state].render(this),n.effects.render()}update(){this.players.forEach((t=>t.update())),I[this.state].update(this),n.effects.update(),this.updateComputer()}}},289:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=a(131),i=a(876),o=a(555),n={render:t=>{const e=t.tSwap*i.SWAP_OFFSET,{x:a,y:o,value:n}=t.selected,{x:r,y:l,value:h}=t.swapped||t.selected;if(t.swapped&&i.base.context.drawImage(i.mapTileInfo[h].texture,r*i.CELL_SIZE+i.TILE_OFFSET+(a-r)*e,l*i.CELL_SIZE+i.TILE_OFFSET+(o-l)*e),i.base.context.drawImage(i.mapTileInfo[n].texture,a*i.CELL_SIZE+i.TILE_OFFSET+(r-a)*e,o*i.CELL_SIZE+i.TILE_OFFSET+(l-o)*e),!t.swapped){const e=i.cornerSelectionOffsets[t.tSelect%i.CORNER_SELECTION_CYCLE];s.cornerSelections.forEach((({texture:a,offset:s,position:o})=>i.base.context.drawImage(a,t.selected.x*i.CELL_SIZE+o.x+s.x*e,t.selected.y*i.CELL_SIZE+o.y+s.y*e)))}},update:t=>{if(!t.swapped)return void(t.tSelect+=1);if(t.tSwap+=1,t.tSwap<=i.SWAP_DURATION)return;t.tSwap=i.SWAP_DURATION;const{x:e,y:a,value:s}=t.selected,{x:n,y:r,value:l}=t.swapped;if(i.base.map[a][e]=s,i.base.map[r][n]=l,t.swap(e,a,n,r),t.reswap)t.reswap=!1,t.selected=t.swapped=null,t.idle();else{t.matched4={turnCount:0,matchedList:{}};const{matched:s,tiles:l,matched4Tiles:h}=t.matchPosition(e,a),{matched:c,tiles:d,matched4Tiles:u}=t.matchPosition(n,r);if(s||c)t.turnCount-=1,t.needUpdate=!0,t.matched4Tiles=[].concat(h,u),t.selected=t.swapped=null,t.explodedTiles=(0,o.combine)([l,d]),t.explosions=[],t.explodedTiles.forEach((e=>{const{x:a,y:s}=e;t.gainTile(e),t.explosions.push({x:a,y:s,value:i.base.map[s][a]})})),t.explode();else{i.base.map[a][e]=-1,i.base.map[r][n]=-1;const s=t.selected.x,o=t.selected.y;t.selected.x=t.swapped.x,t.selected.y=t.swapped.y,t.swapped.x=s,t.swapped.y=o,t.reswap=!0,t.tSwap=0}}}};e.default=n},554:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={render:()=>{},update:t=>{t.wait.timer+=1,t.wait.timer<t.wait.maxTimer||t.wait.callback()}}},457:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.font=e.Font=void 0;const s=a(131),i=a(876);class o{constructor(){}draw({text:t,x:e,y:a}){e=e||i.SCREEN_WIDTH/2,a=a||i.BOARD_SIZE/2;const o=[];let n=0;for(let e=0;e<t.length;e+=1){const a=t.charAt(e).toUpperCase(),i=s.mapFontChar[a];i&&(o.push(i),n+=i.texture.width+2)}a-=12;let r=e-=Math.floor(n/2);for(let e=0;e<t.length;e+=1){const o=t.charAt(e).toUpperCase(),n=s.mapFontChar[o];if(!n)continue;const{texture:l,offsetY:h}=n;i.base.context.drawImage(l,r,a+h),r+=l.width+2}}}e.Font=o,e.font=new o},821:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;const s=a(131),i=a(876),o=a(555),n=a(279),r=i.BOARD_SIZE+24;e.Player=class{index;game;life;mana;energy;attack;intelligence;barOffsetX;bars;energyTimer;avatar;avatarOffset;spins;turn;constructor({game:t,index:e,attack:a,life:o,intelligence:l,avatar:h}){this.index=e,this.game=t,this.attack=a,this.life={maxValue:o,value:o,display:o,timer:0},this.energy={maxValue:i.DEFAULT_ENERGY,value:i.DEFAULT_ENERGY,display:i.DEFAULT_ENERGY,timer:0},this.mana={maxValue:i.DEFAULT_MANA,value:0,display:0,timer:0},this.bars=[{attribute:this.life,maxTimer:30,texture:s.barTextures.life},{attribute:this.energy,maxTimer:20,texture:s.barTextures.energy},{attribute:this.mana,maxTimer:25,texture:s.barTextures.mana}],this.intelligence=l,this.barOffsetX=0===e?132:i.SCREEN_WIDTH-132-s.barTextures.life.width,this.energyTimer=0,this.avatar=s.avatarTextures[h][e],this.avatarOffset={x:0===this.index?62:i.SCREEN_WIDTH-62-this.avatar.width,y:r},this.spins=Array.from({length:2}).map(((t,e)=>new n.Spin(this.avatarOffset.x-3,this.avatarOffset.x+this.avatar.width+3,this.avatarOffset.y-3,this.avatarOffset.y+this.avatar.height+3,.8,"CW",40,3,this.avatarOffset.x+(0===e?7:this.avatar.width+3-10),this.avatarOffset.y+(0===e?-3:this.avatar.height+3)))),this.turn=0}getHintIndex(t){const e=(0,o.random)(this.intelligence,101),a=Math.floor((1-t)*e/100)+t-1;return console.log("Intelligence: ",this.intelligence),console.log("Chance: ",e),console.log("Length: ",t),console.log("Hint Index: ",a),a}takeDamage(t){this.life.timer=0,this.life.value=this.life.value-t,this.life.value<0&&(this.life.value=0)}gainLife(t){this.life.timer=0,this.life.value=this.life.value+t*this.life.maxValue/100,this.life.value>this.life.maxValue&&(this.life.value=this.life.maxValue)}gainEnergy(t){this.energy.timer=0,this.energy.value=this.energy.value+t,this.energy.value>this.energy.maxValue&&(this.energy.value=this.energy.maxValue)}gainMana(t){this.mana.timer=0,this.mana.value=this.mana.value+t,this.mana.value>this.mana.maxValue&&(this.mana.value=this.mana.maxValue)}render(){this.bars.forEach((({texture:t,attribute:e},a)=>{const s=e.display/e.maxValue*84;s<1||i.base.context.drawImage(t,0,0,s,14,this.barOffsetX,i.BOARD_SIZE+24+20*a,s,14)})),i.base.context.drawImage(this.avatar,this.avatarOffset.x,this.avatarOffset.y),this.spins.forEach((t=>t.render()))}update(){this.index===this.game.playerTurn&&(this.energyTimer+=1,this.energyTimer%i.LOSE_ENERGY_INTERVAL==0&&(this.energy.value-=1)),this.bars.forEach((({attribute:t,maxTimer:e})=>{if(Math.abs(t.display-t.value)<.1)return;t.timer+=1,t.timer>e&&(t.timer=e);let a=-t.timer/e+1;a=2*a-1,a=(Math.cbrt(a)+1)/2,t.display=t.value+(t.display-t.value)*a})),this.spins.forEach((t=>{this.index===this.game.playerTurn?t.activate():t.deactivate(),t.update()}))}}},279:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Spin=void 0;const s=a(876),i={CW:{HT:(t,e)=>{e.x+=t.speed,e.x<=t.boundRight||(e.y=e.y+e.x-t.boundRight,e.x=t.boundRight,e.direction="VR")},VR:(t,e)=>{e.y+=t.speed,e.y<=t.boundBottom||(e.x=e.x+t.boundBottom-e.y,e.y=t.boundBottom,e.direction="HB")},HB:(t,e)=>{e.x-=t.speed,e.x>=t.boundLeft||(e.y=e.y+e.x-t.boundLeft,e.x=t.boundLeft,e.direction="VL")},VL:(t,e)=>{e.y-=t.speed,e.y>=t.boundTop||(e.x=e.x+t.boundTop-e.y,e.y=t.boundTop,e.direction="HT")}},CCW:{HT:(t,e)=>{e.x-=t.speed,e.x>=t.boundLeft||(e.y=e.y+t.boundLeft-e.x,e.x=t.boundLeft,e.direction="VL")},VL:(t,e)=>{e.y+=t.speed,e.y<=t.boundBottom||(e.x=e.x+e.y-t.boundBottom,e.y=t.boundBottom,e.direction="HB")},HB:(t,e)=>{e.x+=t.speed,e.x>=t.boundRight||(e.y=e.y+t.boundRight-e.x,e.x=t.boundRight,e.direction="VR")},VR:(t,e)=>{e.y-=t.speed,e.y>=t.boundTop||(e.x=e.x+e.y-t.boundTop,e.y=t.boundTop,e.direction="HT")}}};e.Spin=class{boundLeft;boundRight;boundTop;boundBottom;speed;rotation;thickness;points;active;opacity;constructor(t,e,a,s,o,n,r,l,h,c){this.boundLeft=t,this.boundRight=e,this.boundTop=a,this.boundBottom=s,this.rotation=n,this.thickness=l;const d=((s,i)=>s===t?"VL":s===e?"VR":i===a?"HT":"HB")(h,c);this.speed=r;const u={x:h,y:c,direction:d};i[this.rotation][d](this,u),this.points=[{x:h,y:c,direction:d},u],this.speed=o,this.active=!1,this.opacity=0}getMidPoint=()=>{const{direction:t}=this.points[0];return"HT"===t&&"CW"===this.rotation||"VR"===t&&"CCW"===this.rotation?{x:this.boundRight,y:this.boundTop}:"VR"===t&&"CW"===this.rotation||"HB"===t&&"CCW"===this.rotation?{x:this.boundRight,y:this.boundBottom}:"HB"===t&&"CW"===this.rotation||"VL"===t&&"CCW"===this.rotation?{x:this.boundLeft,y:this.boundBottom}:{x:this.boundLeft,y:this.boundTop}};activate(){this.active||(this.opacity=0,this.active=!0)}deactivate(){this.active&&(this.opacity=1,this.active=!1)}update(){this.active?(this.opacity+=.05,this.opacity>1&&(this.opacity=1)):(this.opacity-=.05,this.opacity<0&&(this.opacity=0)),this.points.forEach((t=>{i[this.rotation][t.direction](this,t)}))}render(){const{x:t,y:e}=this.points[0],{x:a,y:i}=this.points[1],o=s.base.context;if(o.globalAlpha=this.opacity,o.lineWidth=this.thickness,o.strokeStyle="#96e6e0",t===a||e===i)return o.beginPath(),o.moveTo(t,e),o.lineTo(a,i),o.stroke(),void(o.globalAlpha=1);const{x:n,y:r}=this.getMidPoint();o.beginPath(),o.moveTo(t,e),o.lineTo(n,r),o.lineTo(a,i),o.stroke(),o.globalAlpha=1}}},450:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Star=void 0;const s=a(131),i=a(876);e.Star=class{x;y;vx;vy;timer;animation;constructor(t,e,a,s){this.x=t,this.y=e,this.vx=a,this.vy=s,this.timer=0,this.animation=0}render(){const t=s.starTextures[this.animation];i.base.context.drawImage(t,this.x-t.width/2,this.y-t.height/2)}update(){this.timer+=1,this.x+=this.vx,this.y+=this.vy,this.timer%2==0&&(this.animation+=1,4===this.animation&&(this.animation=0))}}},451:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.resize=e.rotate180=e.rotateCCW90=e.rotateCW90=e.flipVertical=e.flipHorizontal=void 0,e.flipHorizontal=t=>{const e=t.width,a=t.height,s=document.createElement("canvas");s.width=e,s.height=a;const i=s.getContext("2d");return i.translate(e,0),i.scale(-1,1),i.drawImage(t,0,0),(t=new Image).src=s.toDataURL("image/png"),new Promise((e=>t.onload=()=>e(t)))},e.flipVertical=t=>{const e=t.width,a=t.height,s=document.createElement("canvas");s.width=e,s.height=a;const i=s.getContext("2d");return i.translate(0,0),i.scale(1,-1),i.drawImage(t,0,-t.height),(t=new Image).src=s.toDataURL("image/png"),new Promise((e=>t.onload=()=>e(t)))},e.rotateCW90=t=>{const e=document.createElement("canvas");e.width=t.height,e.height=t.width;const a=e.width,s=e.height,i=e.getContext("2d");return i.translate(a/2,s/2),i.rotate(Math.PI/2),i.drawImage(t,-s/2,-a/2),(t=new Image).src=e.toDataURL("image/png"),new Promise((e=>t.onload=()=>e(t)))},e.rotateCCW90=t=>{const e=document.createElement("canvas");e.width=t.height,e.height=t.width;const a=e.width,s=e.height,i=e.getContext("2d");return i.translate(a/2,s/2),i.rotate(-Math.PI/2),i.drawImage(t,-s/2,-a/2),(t=new Image).src=e.toDataURL("image/png"),new Promise((e=>t.onload=()=>e(t)))},e.rotate180=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.width,s=e.height,i=e.getContext("2d");return i.translate(a/2,s/2),i.rotate(Math.PI),i.drawImage(t,-a/2,-s/2),(t=new Image).src=e.toDataURL("image/png"),new Promise((e=>t.onload=()=>e(t)))},e.resize=(t,e=1)=>{const a=Math.floor(t.width*e),s=Math.floor(t.height*e),i=document.createElement("canvas");i.width=a,i.height=s;const o=i.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(t,0,0,a,s);const n=new Image;return n.src=i.toDataURL("image/png"),new Promise((t=>{n.onload=()=>t(n)}))}},555:(t,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.combine=e.getKey=e.findBelow=e.check=e.generateMap=e.randomTile=e.random=e.getImageSrc=e.getKeys=e.getAppName=void 0;const s=a(876);e.getAppName=()=>s.APP_NAME,e.getKeys=Object.keys,e.getImageSrc=(t,e="png")=>`/static/images/${t}.${e}`,e.random=(t,e)=>Math.floor(Math.random()*(e-t))+t;let i=0;const o=Array.from({length:s.COUNT_TILES}).map(((t,e)=>{const a=s.mapTileInfo[e].probability;return i+=a,i}));e.randomTile=()=>{const t=(0,e.random)(0,i);for(let e=0;e<s.COUNT_TILES;e+=1)if(t<=o[e])return e;return-1},e.generateMap=()=>{const t=Array.from({length:s.MAP_WIDTH}).map((()=>Array.from({length:s.MAP_WIDTH}).map(e.randomTile))),a=(e,a,s,i)=>{const o=t[a][e];return o===s||i.includes(o)},i=(e,i)=>{let o=0,n=0;const r=t[i][e],l=s.mapTileInfo[r].compatible;let h=e+1;for(;h<s.MAP_WIDTH&&a(h,i,r,l);)o+=1,h+=1;if(o>=2)return!0;let c=i+1;for(;c<s.MAP_WIDTH&&a(e,c,r,l);)n+=1,c+=1;return n>=2};let o=!0;for(;o;){o=!1;for(let a=0;a<s.MAP_WIDTH;a+=1)for(let n=0;n<s.MAP_WIDTH;n+=1)i(n,a)&&(o=!0,t[a][n]=(0,e.randomTile)())}return t},e.check=(t,e,a)=>t===e||a.includes(t),e.findBelow=t=>t.reduce(((t,e)=>t<e.y?e.y:t),-1),e.getKey=(t,e)=>e*s.MAP_WIDTH+t;const n=[{x:0,y:-1,condition:(t,e)=>e>=1},{x:1,y:-1,condition:(t,e)=>t<s.MAP_WIDTH_1&&e>=1},{x:1,y:0,condition:(t,e)=>t<s.MAP_WIDTH_1},{x:1,y:1,condition:(t,e)=>t<s.MAP_WIDTH_1&&e<s.MAP_WIDTH_1},{x:0,y:1,condition:(t,e)=>e<s.MAP_WIDTH_1},{x:-1,y:1,condition:(t,e)=>t>=1&&e<s.MAP_WIDTH_1},{x:-1,y:0,condition:(t,e)=>t>=1},{x:-1,y:-1,condition:(t,e)=>t>=1&&e>=1}];e.combine=t=>{const a=[],i={};t.forEach((t=>{t.forEach((t=>{const{x:s,y:o}=t,n=(0,e.getKey)(s,o);i[n]||(i[n]=!0,a.push(t))}))}));const o=[];return a.forEach((({x:t,y:a,value:r})=>{r===s.TILES.SWORDRED&&n.forEach((({x:n,y:r,condition:l})=>{if(!l(t,a))return;const h=t+n,c=a+r,d=(0,e.getKey)(h,c);i[d]||(i[d]=!0,o.push({x:h,y:c,point:0,value:s.base.map[c][h]}))}))})),a.push(...o),a}},774:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=void 0,e.clamp=(t,e,a)=>t<e?e:t>a?a:t}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,a),o.exports}(()=>{const t=a(131),e=a(876),s=new(a(989).Game),i=(t=0)=>{requestAnimationFrame(i),s.update(),s.render()};(async()=>{(()=>{const t=document.getElementById("canvas"),a=t.getContext("2d");t.width=e.SCREEN_WIDTH,t.height=e.SCREEN_HEIGHT,a.imageSmoothingEnabled=!1,e.base.canvas=t,e.base.context=a})(),await(0,t.loadTextures)(),s.init(),e.base.canvas.addEventListener("click",(t=>{s.onClick(t)})),document.addEventListener("keydown",(t=>{s.onKeyDown(t)})),i()})()})()})();
//# sourceMappingURL=index.js.map