(()=>{"use strict";var e={876:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AVATAR_OFFSET_Y=t.AVATAR_OFFSET_X=t.hintArrowOffsets=t.cornerSelectionOffsets=t.base=t.mapTileInfo=t.COUNT_TILES=t.TILES=t.TIMER_HINT_DELAY_DEFAULT=t.LOSE_ENERGY_INTERVAL=t.OPACITY_ZERO=t.DEFAULT_ENERGY=t.DEFAULT_MANA=t.PLAYER_INTELLIGENCE=t.HINT_ARROW_CYCLE=t.CORNER_SELECTION_CYCLE=t.SCALE_RATIO=t.GRAVITY=t.VELOCITY_BASE=t.SWAP_OFFSET=t.SWAP_DURATION=t.MATCH_4_POINT=t.GAIN_TURN=t.TILE_OFFSET=t.TILE_LENGTH=t.REAL_TILE_SIZE=t.TILE_SIZE=t.SCREEN_HEIGHT=t.SCREEN_WIDTH=t.MENU_HEIGHT=t.BOARD_SIZE=t.CELL_SIZE_2=t.CELL_SIZE=t.TOTAL_TILES=t.MAP_WIDTH_1=t.MAP_WIDTH=t.BOARD_COLORS=t.INTERVAL=t.FPS=t.APP_NAME=void 0,t.APP_NAME="Loạn 12 Sứ Quân",t.FPS=60,t.INTERVAL=1e3/t.FPS,t.BOARD_COLORS=["#3e3226","#554933"],t.MAP_WIDTH=8,t.MAP_WIDTH_1=t.MAP_WIDTH-1,t.TOTAL_TILES=t.MAP_WIDTH*t.MAP_WIDTH,t.CELL_SIZE=60,t.CELL_SIZE_2=t.CELL_SIZE/2,t.BOARD_SIZE=t.MAP_WIDTH*t.CELL_SIZE,t.MENU_HEIGHT=96,t.SCREEN_WIDTH=t.BOARD_SIZE,t.SCREEN_HEIGHT=t.BOARD_SIZE+t.MENU_HEIGHT,t.TILE_SIZE=50,t.REAL_TILE_SIZE=28,t.TILE_LENGTH=7,t.TILE_OFFSET=Math.floor((t.CELL_SIZE-t.TILE_SIZE)/2),t.GAIN_TURN=3,t.MATCH_4_POINT=50,t.SWAP_DURATION=10,t.SWAP_OFFSET=t.CELL_SIZE/t.SWAP_DURATION,t.VELOCITY_BASE=3.5,t.GRAVITY=.27,t.SCALE_RATIO=t.TILE_SIZE/t.REAL_TILE_SIZE,t.CORNER_SELECTION_CYCLE=30,t.HINT_ARROW_CYCLE=30,t.PLAYER_INTELLIGENCE=20,t.DEFAULT_MANA=72,t.DEFAULT_ENERGY=100,t.OPACITY_ZERO=1e-4,t.LOSE_ENERGY_INTERVAL=300,t.TIMER_HINT_DELAY_DEFAULT=300,t.TILES={SWORD:0,HEART:1,GOLD:2,ENERGY:3,MANA:4,EXP:5,SWORDRED:6},t.COUNT_TILES=Object.keys(t.TILES).length,t.mapTileInfo={[t.TILES.SWORD]:{compatible:[t.TILES.SWORDRED],probability:90,point:10,texture:null,explosions:[]},[t.TILES.HEART]:{compatible:[],probability:100,point:9,texture:null,explosions:[]},[t.TILES.GOLD]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[t.TILES.ENERGY]:{compatible:[],probability:100,point:7,texture:null,explosions:[]},[t.TILES.MANA]:{compatible:[],probability:100,point:8,texture:null,explosions:[]},[t.TILES.EXP]:{compatible:[],probability:100,point:6,texture:null,explosions:[]},[t.TILES.SWORDRED]:{compatible:[t.TILES.SWORD],probability:10,point:30,texture:null,explosions:[]}},t.base={},t.cornerSelectionOffsets=Array.from({length:t.CORNER_SELECTION_CYCLE}).map(((e,a)=>Math.floor(3*Math.sin(2*Math.PI*a/t.CORNER_SELECTION_CYCLE)))),t.hintArrowOffsets=Array.from({length:t.HINT_ARROW_CYCLE}).map(((e,a)=>Math.floor(3*Math.sin(2*Math.PI*a/t.HINT_ARROW_CYCLE)))),t.AVATAR_OFFSET_X=62,t.AVATAR_OFFSET_Y=t.BOARD_SIZE+24},553:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CauseDamage=void 0;const s=a(876),i=a(288),o=a(603);class n extends i.Effect{frame;halfWidth;halfHeight;constructor(e,t){super(e,t),this.frame=0,this.halfWidth=o.damageTextures[this.frame].width/2,this.halfHeight=o.damageTextures[this.frame].height/2}render(){s.base.context.drawImage(o.damageTextures[this.frame],this.x-this.halfWidth,this.y-this.halfHeight)}update(){this.timer+=1,this.timer%3==0&&(this.frame+=1,this.frame>4&&(this.isAlive=!1))}}t.CauseDamage=n},288:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Effect=void 0,t.Effect=class{isAlive;x;y;timer;opacity;constructor(e,t){this.timer=0,this.isAlive=!0,this.opacity=1,this.x=e,this.y=t}render(){}update(){}}},813:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlickeringText=void 0;const s=a(876),i=a(457),o=a(288);class n extends o.Effect{text;show;speed;constructor({text:e,x:t=0,y:a=0}){super(t,a),this.text=e,this.show=!0,this.speed=8}render(){this.show&&(s.base.context.save(),s.base.context.globalAlpha=this.opacity,i.font.draw({text:this.text,x:this.x,y:this.y}),s.base.context.restore())}update(){this.timer+=1,this.opacity-=.012,this.timer%Math.floor(this.speed)==0&&(this.timer=0,this.speed-=.01,this.show=!this.show),this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1)}}t.FlickeringText=n},639:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FloatingText=void 0;const s=a(876),i=a(457),o=a(288);class n extends o.Effect{text;isFadeIn;constructor({text:e,x:t=0,y:a=0}){super(t,a),this.text=e,this.isFadeIn=!0,this.opacity=0}render(){s.base.context.save(),s.base.context.globalAlpha=this.opacity,i.font.draw({text:this.text,x:this.x,y:this.y}),s.base.context.restore()}update(){this.y-=.8,this.isFadeIn?(this.opacity+=.12,this.opacity>1&&(this.isFadeIn=!1,this.opacity=1)):(this.opacity-=.04,this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1))}}t.FloatingText=n},401:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GainTile=void 0;const s=a(876),i=a(288),o=a(555),n=a(774),r=a(603),l=Array.from({length:3});class h extends i.Effect{tile;maxTimer;halfSize;list;constructor({tile:e,startX:t,startY:a,endX:s,endY:i}){super(t,a),this.tile=e;const n=s-t,h=i-a;this.maxTimer=Math.floor(Math.sqrt(n*n+h*h)/8)+15,this.halfSize=Math.floor(r.crystalTextures[this.tile][0].width/2),this.list=l.map((()=>{const e=t+(0,o.random)(-70,70),n=a+(0,o.random)(-70,70);return{x:e,y:n,startX:e,startY:n,distanceX:s+(0,o.random)(-30,30)-e,distanceY:i+(0,o.random)(5,35)-n,timer:(0,o.random)(-20,-1),frame:-1,alive:!1,opacity:1}}))}render(){this.list.forEach((({alive:e,frame:t,x:a,y:i,opacity:o})=>{e&&(1!==o&&(s.base.context.save(),s.base.context.globalAlpha=o),s.base.context.drawImage(r.crystalTextures[this.tile][t],a-this.halfSize,i-this.halfSize),1!==o&&s.base.context.restore())}))}update(){let e=0;this.list.forEach((t=>{if(t.timer+=1,t.timer<0)return;0===t.timer&&(t.alive=!0);const a=(0,n.animateGainTile)(t.timer/this.maxTimer);t.x=t.startX+a*t.distanceX,t.y=t.startY+a*t.distanceY,t.timer%4==0&&(t.frame=t.timer/4%6),t.timer>=this.maxTimer-4&&(t.opacity-=.25),t.timer>=this.maxTimer&&(t.alive=!1,e+=1)})),3===e&&(this.isAlive=!1)}}t.GainTile=h},827:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.effects=t.Effects=void 0;class a{list;constructor(){this.list=[]}render(){this.list.forEach((e=>e.render()))}update(){let e=!1;this.list.forEach((t=>{t.update(),e=e||!t.isAlive})),e&&(this.list=this.list.filter((e=>e.isAlive)))}add(e){this.list.push(e)}}t.Effects=a,t.effects=new a},170:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StarExplosion=void 0;const s=a(876),i=a(450),o=a(288);class n extends o.Effect{list;constructor(e,t){super(e,t),this.list=[];for(let a=0;a<20;a+=1){const s=2*Math.PI*a/20;this.list.push(new i.Star(e,t,4*Math.cos(s),4*Math.sin(s)))}}render(){s.base.context.save(),s.base.context.globalAlpha=this.opacity,this.list.forEach((e=>e.render())),s.base.context.restore()}update(){this.opacity-=.025,this.list.forEach((e=>e.update())),this.opacity<s.OPACITY_ZERO&&(this.isAlive=!1)}}t.StarExplosion=n},894:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SwordAttack=void 0;const s=a(876),i=a(288),o=a(774),n=a(827),r=a(553),l=a(603),h=[{delay:8,x:10,y:-5},{delay:4,x:-5,y:5},{delay:0,x:20,y:-5}],c=h.length;class d extends i.Effect{attackingPlayer;attackedPlayer;playerIndex;halfSize;endX;endY;countDead;list;constructor(e,t){super(0,0),this.attackingPlayer=e,this.attackedPlayer=t,this.playerIndex=e.index;const a=t.avatarOffset.x+t.avatar.width/2,i=t.avatarOffset.y+t.avatar.height/2;this.halfSize=l.swordCrystalTextures[0][2].width/2,this.endX=a,this.endY=i;const o=this.playerIndex*s.SCREEN_WIDTH+(0===this.playerIndex?-0:0);this.list=h.map((({x:e,y:t,delay:s})=>{const n=(0===this.playerIndex?1:-1)*e+o,r=t+143;return{x:n,y:r,startX:n,startY:r,timer:-1-s,alive:!1,distanceX:a-o,distanceY:i-143}})),this.countDead=0}render(){this.list.forEach((({alive:e,x:t,y:a})=>{e&&s.base.context.drawImage(l.swordCrystalTextures[this.playerIndex][2],t-this.halfSize,a-this.halfSize)}))}update(){this.list.forEach((e=>{if(e.timer+=1,e.timer<0)return;0===e.timer&&(e.alive=!0);const t=(0,o.animateSword)(e.timer/40);e.x=e.startX+t*e.distanceX,e.y=e.startY+t*e.distanceY,40===e.timer&&(e.alive=!1,this.countDead+=1,1===this.countDead&&this.attackedPlayer.shock(),this.countDead===c&&(this.isAlive=!1,n.effects.add(new r.CauseDamage(this.endX,this.endY-10))))}))}}t.SwordAttack=d},988:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),i=a(555),o={render:e=>{e.explosions.forEach((({x:t,y:a,value:i})=>{const o=s.mapTileInfo[i].explosions[e.tExplode];s.base.context.drawImage(o,t*s.CELL_SIZE+Math.floor((s.CELL_SIZE-o.width)/2),a*s.CELL_SIZE+Math.floor((s.CELL_SIZE-o.height)/2))}))},update:e=>{if(e.tExplode2+=1,e.tExplode2%2!=0)return;if(e.tExplode+=1,4!==e.tExplode)return;e.tExplode=0,e.state="FALL",e.fall={};const t=e.fall;e.explodedTiles.forEach((({x:a,y:i})=>{s.base.map[i][a]=-1,e.fall[a]?!t[a].list.find((({x:e,y:t})=>e===a&&t===i))&&t[a].list.push({x:a,y:i,v:0,offset:0,value:-1}):t[a]={list:[{x:a,y:i,v:0,offset:0,value:-1}],below:-1}})),(0,i.getKeys)(t).forEach((a=>{t[a].below=(0,i.findBelow)(t[a].list);const o=t[a].list.length;t[a].list=[],a=Number(a);for(let i=e.fall[a].below;i>=0;i-=1)-1!==s.base.map[i][a]&&(t[a].list.push({x:a,y:i,v:s.VELOCITY_BASE,offset:0,value:s.base.map[i][a]}),s.base.map[i][a]=-1);for(let e=0;e<o;e+=1)t[a].list.push({x:a,y:-1-e,v:s.VELOCITY_BASE,offset:0,value:(0,i.randomTile)()})}))}};t.default=o},613:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),i=a(555),o=a(774);let n=[];const r=(e,t,a)=>(0,o.clamp)(3*(e+t+1)+7-a,0,10)/10,l={render:e=>{e.isFadeIn&&(e=>{const t=e.fall;(0,i.getKeys)(t).forEach((e=>{t[e].list.forEach((({x:e,y:t,value:a,offset:i})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET+i)}))})),n.forEach((({x:e,y:t,value:a})=>s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET)))})(e),e.isFadeOut&&(e=>{for(let t=0;t<s.MAP_WIDTH;t+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const i=a*s.CELL_SIZE,o=t*s.CELL_SIZE,n=r(a,t,e.tFadeOut),l=Math.floor(s.TILE_SIZE*n),h=Math.floor((s.CELL_SIZE-l)/2);0!==l&&s.base.context.drawImage(s.mapTileInfo[s.base.map[t][a]].texture,i+h,o+h,l,l)}})(e)},update:e=>{e.isFadeIn&&(e=>{e.tFadeIn+=1;const t=e.fall;for(let a=0;a<s.MAP_WIDTH;a+=1){let i=e.tFadeIn-3*a;i<1&&(i=1),i%6==0&&t[a].pushCount<s.MAP_WIDTH&&(t[a].list.push({x:a,y:-1,v:s.VELOCITY_BASE+4,offset:0,value:s.base.map[s.MAP_WIDTH_1-t[a].pushCount][a]}),t[a].pushCount+=1)}(0,i.getKeys)(t).forEach((a=>{const i=t[a];a=Number(a);let o=!1;if(i.list.forEach(((e,t)=>{e.v+=1.4*s.GRAVITY,e.offset+=e.v;const a=e.y+Math.floor((e.offset+6)/s.CELL_SIZE);0===t?a>=i.below&&(o=!0,i.below-=1):(e.offset>=i.list[t-1].offset-6||a>=i.below-t+1)&&(e.v=s.VELOCITY_BASE,e.offset=Math.floor(e.offset/s.CELL_SIZE)*s.CELL_SIZE)})),o){const t=i.list.shift();t.y=i.below+1,n.push(t),n.length===s.TOTAL_TILES&&(e.idle(),n=[],e.isFadeIn=e.isFadeOut=!1)}}))})(e),e.isFadeOut&&(e=>{e.tFadeOut+=1,0===r(2,2,e.tFadeOut)&&(e.isFadeIn||e.fadeIn())})(e)}};t.default=l},27:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),i=a(555),o={render:e=>{const t=e.fall;(0,i.getKeys)(t).forEach((e=>{t[e].list.forEach((({x:e,y:t,value:a,offset:i})=>{s.base.context.drawImage(s.mapTileInfo[a].texture,e*s.CELL_SIZE+s.TILE_OFFSET,t*s.CELL_SIZE+s.TILE_OFFSET+i)}))}))},update:e=>{let t=!1;const a=e.fall;if((0,i.getKeys)(a).forEach((e=>{const i=a[e];e=Number(e);let o=!1;i.list.forEach(((t,a)=>{t.v+=s.GRAVITY,t.offset+=t.v;const n=t.y+Math.floor((t.offset+6)/s.CELL_SIZE);0===a?n>=i.below&&(o=!0,s.base.map[i.below][e]=t.value,i.below-=1):(t.offset>=i.list[a-1].offset-6||n>=i.below-a+1)&&(t.v=s.VELOCITY_BASE,t.offset=Math.floor(t.offset/s.CELL_SIZE)*s.CELL_SIZE)})),o&&i.list.shift(),i.list.length&&(t=!0)})),t)return;e.matched4={turnCount:0,matchedList:{}},e.matched4Tiles=[];const o=[];for(let t=0;t<s.MAP_WIDTH;t+=1)for(let a=0;a<s.MAP_WIDTH;a+=1){const{matched:s,tiles:i,matched4Tiles:n}=e.matchPosition(a,t);s&&o.push(i),n.length&&(e.matched4Tiles=e.matched4Tiles.concat(n))}o.length?(e.explodedTiles=(0,i.combine)(o),e.explosions=[],e.explodedTiles.forEach((t=>{const{x:a,y:i}=t;e.gainTile(t),e.explosions.push({x:a,y:i,value:s.base.map[i][a]})})),e.explode()):(e.findAllMatchedPositions(),e.idle())}};t.default=o},879:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),i=a(603),o={render:e=>{if(e.tHintDelay>0)return;const t=e.matchedPositions[e.hintIndex];if(!t)return;const{x0:a,y0:o,x1:n,y1:r}=t;let l="UP";n>a?l="RIGHT":n<a?l="LEFT":r>o&&(l="DOWN");const{texture:h,offset:c,drt:d}=i.hintArrows[l],u=s.hintArrowOffsets[e.tIdle%s.HINT_ARROW_CYCLE];s.base.context.drawImage(h,a*s.CELL_SIZE+c.x+d.x*u,o*s.CELL_SIZE+c.y+d.y*u)},update:e=>{e.tHintDelay>0?e.tHintDelay-=1:e.tIdle+=1}};t.default=o},989:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const i=a(876),o=a(827),n=a(813),r=a(639),l=a(170),h=a(821),c=a(555),d=s(a(988)),u=s(a(613)),p=s(a(27)),m=s(a(879)),E=s(a(289)),f=s(a(554)),T=a(401),x=a(894),y=a(603),I={IDLE:m.default,SELECT:E.default,EXPLODE:d.default,FALL:p.default,FADE:u.default,WAIT:f.default};t.Game=class{state;selected;swapped;reswap;fall;combo;explosions;explodedTiles;matched4Tiles;matched4;tIdle;tSelect;tSwap;tExplode;tExplode2;tFadeIn;tFadeOut;tHintDelay;isFadeIn;isFadeOut;wait;matchedPositions;hintIndex;players;playerTurn;turnCount;needUpdate;computerTimer;constructor(){}init(){this.players=[new h.Player({game:this,index:0,attack:7,life:100,intelligence:i.PLAYER_INTELLIGENCE,avatar:0}),new h.Player({game:this,index:1,attack:9,life:100,intelligence:100,avatar:1})],this.playerTurn=0,this.turnCount=1,this.matched4={turnCount:0,matchedList:{}},i.base.map=(0,c.generateMap)(),this.findAllMatchedPositions(),this.state="IDLE",this.selected=null,this.swapped=null,this.reswap=!1,this.fall={},this.combo=0,this.explosions=[],this.tIdle=0,this.tSelect=0,this.tSwap=0,this.tExplode=0,this.tExplode2=0,this.tFadeIn=0,this.tFadeOut=0,this.isFadeIn=!1,this.isFadeOut=!1,this.hintIndex=0,this.needUpdate=!0,this.fadeIn()}matchPosition(e,t){let a,s,o=[],n=[];const r=i.base.map[t][e],l=i.mapTileInfo[r].compatible;for(a=e-1;a>=0;){const e=i.base.map[t][a];if(!(0,c.check)(e,r,l))break;o.push({x:a,y:t,point:i.mapTileInfo[e].point,value:e}),a-=1}for(a=e+1;a<i.MAP_WIDTH;){const e=i.base.map[t][a];if(!(0,c.check)(e,r,l))break;o.push({x:a,y:t,point:i.mapTileInfo[e].point,value:e}),a+=1}for(s=t-1;s>=0;){const t=i.base.map[s][e];if(!(0,c.check)(t,r,l))break;n.push({x:e,y:s,point:i.mapTileInfo[t].point,value:t}),s-=1}for(s=t+1;s<i.MAP_WIDTH;){const t=i.base.map[s][e];if(!(0,c.check)(t,r,l))break;n.push({x:e,y:s,point:i.mapTileInfo[t].point,value:t}),s+=1}let h=!0,d=!0;o.length<2&&(o=[],h=!1),n.length<2&&(n=[],d=!1);const u=h||d,p=i.base.map[t][e],m={x:e,y:t,point:i.mapTileInfo[p].point,value:p},E=u?[...o,...n,m]:[],f=e=>{let t=0;return e.forEach((e=>{const a=(0,c.getKey)(e.x,e.y);this.matched4.matchedList[a]||(this.matched4.matchedList[a]=!0,t=1)})),t};let T=[];return o.length>=i.GAIN_TURN&&(T=T.concat(o),this.matched4.turnCount+=f([...o,m])),n.length>=i.GAIN_TURN&&(T=T.concat(n),this.matched4.turnCount+=f([...n,m])),T.length&&T.push(m),{matched:u,tiles:E,point:E.reduce(((e,t)=>e+t.point),0)+(o.length>=i.GAIN_TURN?i.MATCH_4_POINT:0)+(n.length>=i.GAIN_TURN?i.MATCH_4_POINT:0),matched4Tiles:T}}swap(e,t,a,s){const o=i.base.map[t][e];i.base.map[t][e]=i.base.map[s][a],i.base.map[s][a]=o}addMatchedPosition(e,t,a,s,i){this.swap(t,a,s,i);const{matched:o,point:n}=this.matchPosition(t,a),{matched:r,point:l}=this.matchPosition(s,i),h=Math.random()<.5?{x0:s,y0:i,x1:t,y1:a}:{x0:t,y0:a,x1:s,y1:i};(o||r)&&e.push({...h,point:n+l}),this.swap(t,a,s,i)}findAllMatchedPositions(){const e=[];for(let t=0;t<i.MAP_WIDTH_1;t+=1)for(let a=0;a<i.MAP_WIDTH_1;a+=1)this.addMatchedPosition(e,a,t,a+1,t),this.addMatchedPosition(e,a,t,a,t+1);for(let t=0;t<i.MAP_WIDTH_1;t+=1)this.addMatchedPosition(e,i.MAP_WIDTH_1,t,i.MAP_WIDTH_1,t+1);for(let t=0;t<i.MAP_WIDTH_1;t+=1)this.addMatchedPosition(e,t,i.MAP_WIDTH_1,t+1,i.MAP_WIDTH_1);e.sort(((e,t)=>e.point<t.point?1:-1)),this.matchedPositions=e}onClick(e){if("IDLE"!==this.state&&"SELECT"!==this.state||0!==this.playerTurn)return;const t=i.base.canvas,a=e.offsetX*t.width/t.clientWidth,s=e.offsetY*t.height/t.clientHeight;if(a<0||a>=i.BOARD_SIZE||s<0||s>=i.BOARD_SIZE)return;const o=Math.floor(a/i.CELL_SIZE),n=Math.floor(s/i.CELL_SIZE);if(this.tSwap=0,!this.selected)return this.selected={x:o,y:n,value:i.base.map[n][o]},i.base.map[n][o]=-1,void(this.state="SELECT");if(Math.abs(o-this.selected.x)+Math.abs(n-this.selected.y)!==1){const{x:e,y:t,value:a}=this.selected;return i.base.map[t][e]=a,this.selected=null,void this.idle()}this.swapped={x:o,y:n,value:i.base.map[n][o]},i.base.map[n][o]=-1}onKeyDown(e){"Escape"===e.key&&this.fadeOut()}changePlayer(){this.playerTurn=1-this.playerTurn,this.turnCount=1}idle(){this.tHintDelay=i.TIMER_HINT_DELAY_DEFAULT,this.state="IDLE",this.combo=0,this.needUpdate&&(this.turnCount>1?o.effects.add(new n.FlickeringText({text:`Còn ${this.turnCount} lượt`})):0===this.turnCount&&this.changePlayer()),this.hintIndex=this.players[this.playerTurn].getHintIndex(this.matchedPositions.length),1===this.playerTurn&&(this.computerTimer=0),this.needUpdate=!1}explode(){this.wait={timer:0,maxTimer:0===this.combo?4:8,callback:()=>{this.explosions.forEach((({x:e,y:t})=>i.base.map[t][e]=-1)),this.state="EXPLODE";const e=this.explosions.reduce(((e,t)=>({x:e.x+t.x,y:e.y+t.y})),{x:0,y:0});this.explosions.some((({value:e})=>e===i.TILES.SWORD||e===i.TILES.SWORDRED))&&(this.players[1-this.playerTurn],o.effects.add(new x.SwordAttack(this.players[this.playerTurn],this.players[1-this.playerTurn]))),this.turnCount+=this.matched4.turnCount;const t=e.x/this.explosions.length,a=e.y/this.explosions.length;this.combo+=1;const s=t*i.CELL_SIZE+i.CELL_SIZE_2,n=a*i.CELL_SIZE+i.CELL_SIZE_2;this.combo<2||(o.effects.add(new r.FloatingText({text:`x${this.combo}`,x:s,y:n+8})),o.effects.add(new l.StarExplosion(s,n)))}},this.state="WAIT"}fadeIn(){this.state="FADE";for(let e=0;e<i.MAP_WIDTH;e+=1)this.fall[e]={list:[],below:i.MAP_WIDTH_1,pushCount:0};this.tFadeIn=0,this.isFadeIn=!0}fadeOut(){this.state="FADE",this.tFadeOut=0,this.isFadeOut=!0}gainTile({value:e,x:t,y:a}){if(e!==i.TILES.SWORD&&e!==i.TILES.SWORDRED){const s=this.players[this.playerTurn];o.effects.add(new T.GainTile({tile:e,startX:t*i.CELL_SIZE+i.CELL_SIZE_2,startY:a*i.CELL_SIZE+i.CELL_SIZE_2,endX:s.avatarOffset.x+s.avatar.width/2,endY:s.avatarOffset.y}))}switch(e){case i.TILES.SWORD:case i.TILES.SWORDRED:const t=this.players[this.playerTurn].attack/4;this.players[1-this.playerTurn].takeDamage(t*(e===i.TILES.SWORDRED?2.5:1));break;case i.TILES.HEART:this.players[this.playerTurn].gainLife(1.5);break;case i.TILES.GOLD:break;case i.TILES.ENERGY:this.players[this.playerTurn].gainEnergy(2);break;case i.TILES.MANA:this.players[this.playerTurn].gainMana(5);case i.TILES.EXP:}}updateComputer(){if(1===this.playerTurn)if(this.computerTimer+=1,70===this.computerTimer){this.tSwap=0;const{x0:e,y0:t}=this.matchedPositions[this.hintIndex];this.selected={x:e,y:t,value:i.base.map[t][e]},i.base.map[t][e]=-1,this.state="SELECT"}else if(100===this.computerTimer){const{x1:e,y1:t}=this.matchedPositions[this.hintIndex];this.swapped={x:e,y:t,value:i.base.map[t][e]},i.base.map[t][e]=-1}}render(){for(let e=0;e<i.MAP_WIDTH;e+=1)for(let t=0;t<i.MAP_WIDTH;t+=1){i.base.context.fillStyle=i.BOARD_COLORS[(e+t)%2];const a=t*i.CELL_SIZE,s=e*i.CELL_SIZE;i.base.context.fillRect(a,s,i.CELL_SIZE,i.CELL_SIZE),-1!==i.base.map[e][t]&&"FADE"!==this.state&&i.base.context.drawImage(i.mapTileInfo[i.base.map[e][t]].texture,a+i.TILE_OFFSET,s+i.TILE_OFFSET)}i.base.context.drawImage(y.menuTexture,0,i.BOARD_SIZE),this.players.forEach((e=>e.render())),I[this.state].render(this),o.effects.render()}update(){this.players.forEach((e=>e.update())),I[this.state].update(this),o.effects.update(),this.updateComputer()}}},289:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(876),i=a(603),o=a(555),n={render:e=>{const t=e.tSwap*s.SWAP_OFFSET,{x:a,y:o,value:n}=e.selected,{x:r,y:l,value:h}=e.swapped||e.selected;if(e.swapped&&s.base.context.drawImage(s.mapTileInfo[h].texture,r*s.CELL_SIZE+s.TILE_OFFSET+(a-r)*t,l*s.CELL_SIZE+s.TILE_OFFSET+(o-l)*t),s.base.context.drawImage(s.mapTileInfo[n].texture,a*s.CELL_SIZE+s.TILE_OFFSET+(r-a)*t,o*s.CELL_SIZE+s.TILE_OFFSET+(l-o)*t),!e.swapped){const t=s.cornerSelectionOffsets[e.tSelect%s.CORNER_SELECTION_CYCLE];i.cornerSelections.forEach((({texture:a,offset:i,position:o})=>s.base.context.drawImage(a,e.selected.x*s.CELL_SIZE+o.x+i.x*t,e.selected.y*s.CELL_SIZE+o.y+i.y*t)))}},update:e=>{if(!e.swapped)return void(e.tSelect+=1);if(e.tSwap+=1,e.tSwap<=s.SWAP_DURATION)return;e.tSwap=s.SWAP_DURATION;const{x:t,y:a,value:i}=e.selected,{x:n,y:r,value:l}=e.swapped;if(s.base.map[a][t]=i,s.base.map[r][n]=l,e.swap(t,a,n,r),e.reswap)e.reswap=!1,e.selected=e.swapped=null,e.idle();else{e.matched4={turnCount:0,matchedList:{}};const{matched:i,tiles:l,matched4Tiles:h}=e.matchPosition(t,a),{matched:c,tiles:d,matched4Tiles:u}=e.matchPosition(n,r);if(i||c)e.turnCount-=1,e.needUpdate=!0,e.matched4Tiles=[].concat(h,u),e.selected=e.swapped=null,e.explodedTiles=(0,o.combine)([l,d]),e.explosions=[],e.explodedTiles.forEach((t=>{const{x:a,y:i}=t;e.gainTile(t),e.explosions.push({x:a,y:i,value:s.base.map[i][a]})})),e.explode();else{s.base.map[a][t]=-1,s.base.map[r][n]=-1;const i=e.selected.x,o=e.selected.y;e.selected.x=e.swapped.x,e.selected.y=e.swapped.y,e.swapped.x=i,e.swapped.y=o,e.reswap=!0,e.tSwap=0}}}};t.default=n},554:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={render:()=>{},update:e=>{e.wait.timer+=1,e.wait.timer<e.wait.maxTimer||e.wait.callback()}}},457:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.font=t.Font=void 0;const s=a(876),i=a(603);class o{constructor(){}draw({text:e,x:t,y:a}){t=t||s.SCREEN_WIDTH/2,a=a||s.BOARD_SIZE/2;const o=[];let n=0;for(let t=0;t<e.length;t+=1){const a=e.charAt(t).toUpperCase(),s=i.mapFontChar[a];s&&(o.push(s),n+=s.texture.width+2)}a-=12;let r=t-=Math.floor(n/2);for(let t=0;t<e.length;t+=1){const o=e.charAt(t).toUpperCase(),n=i.mapFontChar[o];if(!n)continue;const{texture:l,offsetY:h}=n;s.base.context.drawImage(l,r,a+h),r+=l.width+2}}}t.Font=o,t.font=new o},821:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;const s=a(876),i=a(555),o=a(279),n=a(603),r=(0,a(81).createSpringEffect)(8);t.Player=class{index;game;life;mana;energy;attack;intelligence;barOffsetX;bars;energyTimer;avatar;avatarOffset;spins;turn;springIndex;constructor({game:e,index:t,attack:a,life:i,intelligence:r,avatar:l}){this.index=t,this.game=e,this.attack=a,this.life={maxValue:i,value:i,display:i,timer:0},this.energy={maxValue:s.DEFAULT_ENERGY,value:s.DEFAULT_ENERGY,display:s.DEFAULT_ENERGY,timer:0},this.mana={maxValue:s.DEFAULT_MANA,value:0,display:0,timer:0},this.bars=[{attribute:this.life,maxTimer:30,texture:n.barTextures.life},{attribute:this.energy,maxTimer:20,texture:n.barTextures.energy},{attribute:this.mana,maxTimer:25,texture:n.barTextures.mana}],this.intelligence=r,this.barOffsetX=0===t?132:s.SCREEN_WIDTH-132-n.barTextures.life.width,this.energyTimer=0,this.avatar=n.avatarTextures[l][t],this.avatarOffset={x:0===this.index?s.AVATAR_OFFSET_X:s.SCREEN_WIDTH-s.AVATAR_OFFSET_X-this.avatar.width,y:s.AVATAR_OFFSET_Y},this.spins=Array.from({length:2}).map(((e,t)=>new o.Spin(this.avatarOffset.x-3,this.avatarOffset.x+this.avatar.width+3,this.avatarOffset.y-3,this.avatarOffset.y+this.avatar.height+3,.8,"CW",40,3,this.avatarOffset.x+(0===t?7:this.avatar.width+3-10),this.avatarOffset.y+(0===t?-3:this.avatar.height+3)))),this.turn=0,this.springIndex=-1}getHintIndex(e){const t=(0,i.random)(this.intelligence,101),a=Math.floor((1-e)*t/100)+e-1;return console.log("Intelligence: ",this.intelligence),console.log("Chance: ",t),console.log("Length: ",e),console.log("Hint Index: ",a),a}takeDamage(e){this.life.timer=0,this.life.value=this.life.value-e,this.life.value<0&&(this.life.value=0)}gainLife(e){this.life.timer=0,this.life.value=this.life.value+e*this.life.maxValue/100,this.life.value>this.life.maxValue&&(this.life.value=this.life.maxValue)}gainEnergy(e){this.energy.timer=0,this.energy.value=this.energy.value+e,this.energy.value>this.energy.maxValue&&(this.energy.value=this.energy.maxValue)}gainMana(e){this.mana.timer=0,this.mana.value=this.mana.value+e,this.mana.value>this.mana.maxValue&&(this.mana.value=this.mana.maxValue)}shock(){this.springIndex=0}render(){this.bars.forEach((({texture:e,attribute:t},a)=>{const i=t.display/t.maxValue*84;i<1||s.base.context.drawImage(e,0,0,i,14,this.barOffsetX,s.BOARD_SIZE+24+20*a,i,14)}));const e=this.springIndex>-1?r[this.springIndex]:0;s.base.context.drawImage(this.avatar,this.avatarOffset.x+e,this.avatarOffset.y),this.spins.forEach((e=>e.render()))}update(){this.index===this.game.playerTurn&&(this.energyTimer+=1,this.energyTimer%s.LOSE_ENERGY_INTERVAL==0&&(this.energy.value-=1)),this.bars.forEach((({attribute:e,maxTimer:t})=>{if(Math.abs(e.display-e.value)<.1)return;e.timer+=1,e.timer>t&&(e.timer=t);let a=-e.timer/t+1;a=2*a-1,a=(Math.cbrt(a)+1)/2,e.display=e.value+(e.display-e.value)*a})),this.spins.forEach((e=>{this.index===this.game.playerTurn?e.activate():e.deactivate(),e.update()})),this.springIndex>-1&&(this.springIndex+=1,this.springIndex>=r.length&&(this.springIndex=-1))}}},279:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Spin=void 0;const s=a(876),i={CW:{HT:(e,t)=>{t.x+=e.speed,t.x<=e.boundRight||(t.y=t.y+t.x-e.boundRight,t.x=e.boundRight,t.direction="VR")},VR:(e,t)=>{t.y+=e.speed,t.y<=e.boundBottom||(t.x=t.x+e.boundBottom-t.y,t.y=e.boundBottom,t.direction="HB")},HB:(e,t)=>{t.x-=e.speed,t.x>=e.boundLeft||(t.y=t.y+t.x-e.boundLeft,t.x=e.boundLeft,t.direction="VL")},VL:(e,t)=>{t.y-=e.speed,t.y>=e.boundTop||(t.x=t.x+e.boundTop-t.y,t.y=e.boundTop,t.direction="HT")}},CCW:{HT:(e,t)=>{t.x-=e.speed,t.x>=e.boundLeft||(t.y=t.y+e.boundLeft-t.x,t.x=e.boundLeft,t.direction="VL")},VL:(e,t)=>{t.y+=e.speed,t.y<=e.boundBottom||(t.x=t.x+t.y-e.boundBottom,t.y=e.boundBottom,t.direction="HB")},HB:(e,t)=>{t.x+=e.speed,t.x>=e.boundRight||(t.y=t.y+e.boundRight-t.x,t.x=e.boundRight,t.direction="VR")},VR:(e,t)=>{t.y-=e.speed,t.y>=e.boundTop||(t.x=t.x+t.y-e.boundTop,t.y=e.boundTop,t.direction="HT")}}};t.Spin=class{boundLeft;boundRight;boundTop;boundBottom;speed;rotation;thickness;points;active;opacity;constructor(e,t,a,s,o,n,r,l,h,c){this.boundLeft=e,this.boundRight=t,this.boundTop=a,this.boundBottom=s,this.rotation=n,this.thickness=l;const d=((s,i)=>s===e?"VL":s===t?"VR":i===a?"HT":"HB")(h,c);this.speed=r;const u={x:h,y:c,direction:d};i[this.rotation][d](this,u),this.points=[{x:h,y:c,direction:d},u],this.speed=o,this.active=!1,this.opacity=0}getMidPoint=()=>{const{direction:e}=this.points[0];return"HT"===e&&"CW"===this.rotation||"VR"===e&&"CCW"===this.rotation?{x:this.boundRight,y:this.boundTop}:"VR"===e&&"CW"===this.rotation||"HB"===e&&"CCW"===this.rotation?{x:this.boundRight,y:this.boundBottom}:"HB"===e&&"CW"===this.rotation||"VL"===e&&"CCW"===this.rotation?{x:this.boundLeft,y:this.boundBottom}:{x:this.boundLeft,y:this.boundTop}};activate(){this.active||(this.opacity=0,this.active=!0)}deactivate(){this.active&&(this.opacity=1,this.active=!1)}update(){this.active?(this.opacity+=.05,this.opacity>1&&(this.opacity=1)):(this.opacity-=.05,this.opacity<0&&(this.opacity=0)),this.points.forEach((e=>{i[this.rotation][e.direction](this,e)}))}render(){const{x:e,y:t}=this.points[0],{x:a,y:i}=this.points[1],o=s.base.context;if(o.globalAlpha=this.opacity,o.lineWidth=this.thickness,o.strokeStyle="#96e6e0",e===a||t===i)return o.beginPath(),o.moveTo(e,t),o.lineTo(a,i),o.stroke(),void(o.globalAlpha=1);const{x:n,y:r}=this.getMidPoint();o.beginPath(),o.moveTo(e,t),o.lineTo(n,r),o.lineTo(a,i),o.stroke(),o.globalAlpha=1}}},450:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Star=void 0;const s=a(876),i=a(603);t.Star=class{x;y;vx;vy;timer;animation;constructor(e,t,a,s){this.x=e,this.y=t,this.vx=a,this.vy=s,this.timer=0,this.animation=0}render(){const e=i.starTextures[this.animation];s.base.context.drawImage(e,this.x-e.width/2,this.y-e.height/2)}update(){this.timer+=1,this.x+=this.vx,this.y+=this.vy,this.timer%2==0&&(this.animation+=1,4===this.animation&&(this.animation=0))}}},354:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadAvatars=t.avatarTextures=void 0;const s=a(451),i=a(555);t.avatarTextures=Array.from({length:2}).map((()=>[null,null])),t.loadAvatars=async()=>(await Promise.all(t.avatarTextures.map(((e,a)=>new Promise((e=>{(0,i.loadTexture)(`avatars/${a}`).then((e=>(0,s.resize)(e,2))).then((s=>{t.avatarTextures[a][1]=s,e(null)}))}))))),Promise.all(t.avatarTextures.map((e=>new Promise((t=>{(0,s.flipHorizontal)(e[1]).then((a=>{e[0]=a,t(null)}))}))))))},632:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadCommonTextures=t.hintArrows=void 0;const s=a(876),i=a(451),o=a(555);t.hintArrows={},t.loadCommonTextures=async()=>{let e=new Image;e.src=(0,o.getImageSrc)("common/hint-arrow"),await new Promise((t=>e.onload=async()=>{e=await(0,i.resize)(e,2),t(null)})),t.hintArrows.UP={offset:{x:(s.CELL_SIZE-e.width)/2,y:-6},texture:e,drt:{x:0,y:-1}},e=await(0,i.rotateCW90)(e),t.hintArrows.RIGHT={offset:{x:s.CELL_SIZE-e.width+6,y:(s.CELL_SIZE-e.height)/2},texture:e,drt:{x:1,y:0}},e=await(0,i.rotateCW90)(e),t.hintArrows.DOWN={offset:{x:(s.CELL_SIZE-e.width)/2,y:s.CELL_SIZE-e.height+6},texture:e,drt:{x:0,y:1}},e=await(0,i.rotateCW90)(e),t.hintArrows.LEFT={offset:{x:-6,y:(s.CELL_SIZE-e.height)/2},texture:e,drt:{x:-1,y:0}}}},312:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadCornerSelections=t.cornerSelections=void 0;const s=a(876),i=a(451),o=a(555);t.cornerSelections=[],t.loadCornerSelections=()=>{t.cornerSelections=[];let e=new Image;return e.src=(0,o.getImageSrc)("selection/corner"),new Promise((a=>{e.onload=async()=>{const o=await(0,i.flipHorizontal)(e),n=await(0,i.flipVertical)(e),r=await(0,i.flipVertical)(o),l=e.width,h=s.CELL_SIZE-l;t.cornerSelections.push({texture:e,position:{x:0,y:0},offset:{x:1,y:1}}),t.cornerSelections.push({texture:o,position:{x:h,y:0},offset:{x:-1,y:1}}),t.cornerSelections.push({texture:n,position:{x:0,y:h},offset:{x:1,y:-1}}),t.cornerSelections.push({texture:r,position:{x:h,y:h},offset:{x:-1,y:-1}}),a(null)}}))}},808:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadCrystals=t.damageTextures=t.swordCrystalTextures=t.crystalTextures=void 0;const s=a(876),i=a(451),o=a(555);t.crystalTextures=[],t.swordCrystalTextures=[],t.damageTextures=[],t.loadCrystals=async()=>{const e=34;let a=await(0,o.loadTexture)("common/crystals");a=await(0,i.resize)(a,2.62),await Promise.all((0,o.getKeys)(s.TILES).map((async(i,o)=>{const n=s.TILES[i],r=await Promise.all(Array.from({length:6}).map(((t,s)=>new Promise((t=>{const i=document.createElement("canvas");i.width=e,i.height=e;const n=i.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(a,e*s,e*o,e,e,0,0,e,e);const r=new Image;r.src=i.toDataURL(),r.onload=()=>t(r)})))));t.crystalTextures[n]=r}))),t.swordCrystalTextures[0]=t.crystalTextures[s.TILES.SWORDRED],t.swordCrystalTextures[1]=await Promise.all(t.swordCrystalTextures[0].map((e=>(0,i.flipHorizontal)(e)))),a=await(0,o.loadTexture)("common/damage"),a=await(0,i.resize)(a,2);const n=120;t.damageTextures=await Promise.all(Array.from({length:5}).map(((e,t)=>new Promise((e=>{const s=document.createElement("canvas");s.width=n,s.height=66;const i=s.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(a,n*t,0,n,66,0,0,n,66);const o=new Image;o.src=s.toDataURL(),o.onload=()=>e(o)})))))}},888:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadFont=t.mapFontChar=void 0;const s=a(555);t.mapFontChar={},t.loadFont=async()=>{const e=await(0,s.loadTexture)("fonts/fontcap"),a=[0,2,10,16,24,32,40,48,56,64,72,80,84,88,92,80,0,6,12,87,19,26,32,41,49,62,67,92,78,12,96,86,32,49,58,66,74,83,41,92,0,20,8,14,29,48,55,65,37,73,81,90,0,20,7,28,46,57,65,36,90,15,73,0,24,43,52,61,33,82,91,9,70,0,18,42,51,60,28,35,79,9,67,86,93,0,16,42,60,23,29,35,49,74,83,0,9,49,58,18,27,36,67,76,85,0,46,11,22,33,92,57,85,65,73,0,44,33,54,10,20,81,89,64,72,0],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,9,9,9,7,9,9,9,9,9,9,9,9,15,16,0,17,18,18,18,19,20,20,20,20,21,21,24,24,27,27,27,28,29,29,29,29,30,30,33,36,36,36,37,38,38,39,40,42,45,45,45,46,47,50,50,51,52,54,56,57,57,58,59,59,62,63,64,64,64,66,68,69,70,71,71,71,71,74,76,78,80,82,82,83,83,83,86,88,88,92,93,95,95,95,76,94,97,98,102,104,105,106,106,107,107,109,109,110,113,114],o=[2,8,6,8,8,8,8,8,8,8,8,4,4,4,4,7,6,6,7,5,7,6,9,8,13,5,11,8,8,8,4,8,9,9,8,8,9,9,7,7,8,9,6,6,8,7,10,8,9,8,9,8,7,8,8,8,11,8,8,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,9,9,7,7,7,7,7,7,7,7,9,7,7,6,6,6,6,6,9,9,9,9,9,9,9,9,10,9,9,11,11,11,11,11,11,8,8,8,8,8,10,10,10,10,10,10,8,8,8,8,8],n=[1,9,9,9,9,9,9,9,9,9,9,4,6,7,9,9,12,12,7,3,7,12,9,11,9,5,10,8,5,8,9,3,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,9,9,9,9,9,9,9,9,9,12,12,12,12,11,12,12,12,12,12,14,12,12,12,12,12,14,12,12,12,12,11,12,12,12,12,12,14,12,12,12,12,11,12,12,12,12,11,12,12,12,12,12,14,9,12,12,12,12,11,12,12,12,12,11,10,12,12,12,12,12,12,12,12,12,11],r=[11,3,3,3,3,3,3,3,3,3,3,8,8,5,3,3,2,2,4,6,2,2,3,2,3,2,3,4,5,4,5,11,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,2,0,0,0,0,2,0,0,0,0,3],l=[];for(let s=0;s<126;s+=1){const h=' 0123456789.,:!?()+-*/#$%"@<=>;_&ABCDĐEFGHIJKLMNOPQRSTUVWXYZÁÀẢÃẠĂẮẰẲẴẶÂẤẦẨẪẬÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌÔỐỒỔỖỘƠỚỜỞỠỢÚÙỦŨỤƯỨỪỬỮỰÝỲỶỸỴ'.charAt(s),c=Math.floor(2*o[s]),d=Math.floor(2*n[s]),u=document.createElement("canvas");u.width=c,u.height=d;const p=u.getContext("2d");p.imageSmoothingEnabled=!1,p.drawImage(e,a[s],i[s],o[s],n[s],0,0,c,d);const m=new Image;m.src=u.toDataURL("image/png"),l.push(new Promise((e=>m.onload=()=>{t.mapFontChar[h]={texture:m,offsetY:Math.floor(2*r[s])},e(null)})))}return Promise.all(l)}},603:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadTextures=t.starTextures=t.barTextures=t.menuTexture=t.mapFontChar=t.damageTextures=t.swordCrystalTextures=t.crystalTextures=t.cornerSelections=t.hintArrows=t.avatarTextures=void 0;const s=a(354);Object.defineProperty(t,"avatarTextures",{enumerable:!0,get:function(){return s.avatarTextures}});const i=a(632);Object.defineProperty(t,"hintArrows",{enumerable:!0,get:function(){return i.hintArrows}});const o=a(312);Object.defineProperty(t,"cornerSelections",{enumerable:!0,get:function(){return o.cornerSelections}});const n=a(808);Object.defineProperty(t,"crystalTextures",{enumerable:!0,get:function(){return n.crystalTextures}}),Object.defineProperty(t,"swordCrystalTextures",{enumerable:!0,get:function(){return n.swordCrystalTextures}}),Object.defineProperty(t,"damageTextures",{enumerable:!0,get:function(){return n.damageTextures}});const r=a(888);Object.defineProperty(t,"mapFontChar",{enumerable:!0,get:function(){return r.mapFontChar}});const l=a(86);Object.defineProperty(t,"menuTexture",{enumerable:!0,get:function(){return l.menuTexture}}),Object.defineProperty(t,"barTextures",{enumerable:!0,get:function(){return l.barTextures}});const h=a(220);Object.defineProperty(t,"starTextures",{enumerable:!0,get:function(){return h.starTextures}});const c=a(525);t.loadTextures=()=>Promise.all([(0,c.loadTilesAndExplosions)(),(0,o.loadCornerSelections)(),(0,i.loadCommonTextures)(),(0,l.loadMenu)(),(0,s.loadAvatars)(),(0,r.loadFont)(),(0,h.loadStars)(),(0,n.loadCrystals)()])},86:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadMenu=t.barTextures=t.menuTexture=void 0;const s=a(451),i=a(555);t.menuTexture=null,t.barTextures={},t.loadMenu=async()=>{t.menuTexture=await(0,i.loadTexture)("common/menu"),t.menuTexture=await(0,s.resize)(t.menuTexture,2);const e=["life","energy","mana"];let a=await Promise.all(e.map((e=>(0,i.loadTexture)(`common/${e}bar`))));a=await Promise.all(a.map((e=>(0,s.resize)(e,2)))),a.forEach(((a,s)=>{t.barTextures[e[s]]=a}))}},220:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadStars=t.starTextures=void 0;const s=a(451),i=a(555);t.starTextures=[],t.loadStars=async()=>{const e=await(0,i.loadTexture)("common/star");t.starTextures[0]=await(0,s.resize)(e,2);const a=[],o=t.starTextures[0];return a.push((0,s.rotateCW90)(o).then((e=>t.starTextures[1]=e))),a.push((0,s.rotate180)(o).then((e=>t.starTextures[2]=e))),a.push((0,s.rotateCCW90)(o).then((e=>t.starTextures[3]=e))),Promise.all(a)}},525:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadTilesAndExplosions=void 0;const s=a(876),i=a(555);t.loadTilesAndExplosions=async()=>{await Promise.all((0,i.getKeys)(s.TILES).map((e=>((e,t)=>{const a=new Image;return a.src=(0,i.getImageSrc)(`tiles/${t}`),new Promise((t=>a.onload=async()=>{const i=e=>{const t=Math.floor(a.width/s.TILE_LENGTH*s.SCALE_RATIO),i=Math.floor(a.height*s.SCALE_RATIO),o=document.createElement("canvas");o.width=t,o.height=i;const n=o.getContext("2d");n.imageSmoothingEnabled=!1;const r=a.width/s.TILE_LENGTH*e,l=a.width/s.TILE_LENGTH;n.drawImage(a,r,0,l,a.height,0,0,t,i);const h=new Image;return h.src=o.toDataURL("image/png"),new Promise((e=>h.onload=()=>e(h)))};s.mapTileInfo[e].texture=await i(0),s.mapTileInfo[e].explosions=[];for(let t=0;t<6;t+=1)s.mapTileInfo[e].explosions[t]=await i(t+1);t(null)}))})(s.TILES[e],e.toLowerCase()))))}},451:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resize=t.rotate180=t.rotateCCW90=t.rotateCW90=t.flipVertical=t.flipHorizontal=void 0,t.flipHorizontal=e=>{const t=e.width,a=e.height,s=document.createElement("canvas");s.width=t,s.height=a;const i=s.getContext("2d");return i.translate(t,0),i.scale(-1,1),i.drawImage(e,0,0),(e=new Image).src=s.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.flipVertical=e=>{const t=e.width,a=e.height,s=document.createElement("canvas");s.width=t,s.height=a;const i=s.getContext("2d");return i.translate(0,0),i.scale(1,-1),i.drawImage(e,0,-e.height),(e=new Image).src=s.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.rotateCW90=e=>{const t=document.createElement("canvas");t.width=e.height,t.height=e.width;const a=t.width,s=t.height,i=t.getContext("2d");return i.translate(a/2,s/2),i.rotate(Math.PI/2),i.drawImage(e,-s/2,-a/2),(e=new Image).src=t.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.rotateCCW90=e=>{const t=document.createElement("canvas");t.width=e.height,t.height=e.width;const a=t.width,s=t.height,i=t.getContext("2d");return i.translate(a/2,s/2),i.rotate(-Math.PI/2),i.drawImage(e,-s/2,-a/2),(e=new Image).src=t.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.rotate180=e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.width,s=t.height,i=t.getContext("2d");return i.translate(a/2,s/2),i.rotate(Math.PI),i.drawImage(e,-a/2,-s/2),(e=new Image).src=t.toDataURL("image/png"),new Promise((t=>e.onload=()=>t(e)))},t.resize=(e,t=1)=>{const a=Math.floor(e.width*t),s=Math.floor(e.height*t),i=document.createElement("canvas");i.width=a,i.height=s;const o=i.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(e,0,0,a,s);const n=new Image;return n.src=i.toDataURL("image/png"),new Promise((e=>{n.onload=()=>e(n)}))}},555:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadTexture=t.combine=t.getKey=t.findBelow=t.check=t.generateMap=t.randomTile=t.random=t.getImageSrc=t.getKeys=t.getAppName=void 0;const s=a(876);t.getAppName=()=>s.APP_NAME,t.getKeys=Object.keys,t.getImageSrc=(e,t="png")=>`/static/images/${e}.${t}`,t.random=(e,t)=>Math.floor(Math.random()*(t-e))+e;let i=0;const o=Array.from({length:s.COUNT_TILES}).map(((e,t)=>{const a=s.mapTileInfo[t].probability;return i+=a,i}));t.randomTile=()=>{const e=(0,t.random)(0,i);for(let t=0;t<s.COUNT_TILES;t+=1)if(e<=o[t])return t;return-1},t.generateMap=()=>{const e=Array.from({length:s.MAP_WIDTH}).map((()=>Array.from({length:s.MAP_WIDTH}).map(t.randomTile))),a=(t,a,s,i)=>{const o=e[a][t];return o===s||i.includes(o)},i=(t,i)=>{let o=0,n=0;const r=e[i][t],l=s.mapTileInfo[r].compatible;let h=t+1;for(;h<s.MAP_WIDTH&&a(h,i,r,l);)o+=1,h+=1;if(o>=2)return!0;let c=i+1;for(;c<s.MAP_WIDTH&&a(t,c,r,l);)n+=1,c+=1;return n>=2};let o=!0;for(;o;){o=!1;for(let a=0;a<s.MAP_WIDTH;a+=1)for(let n=0;n<s.MAP_WIDTH;n+=1)i(n,a)&&(o=!0,e[a][n]=(0,t.randomTile)())}return e},t.check=(e,t,a)=>e===t||a.includes(e),t.findBelow=e=>e.reduce(((e,t)=>e<t.y?t.y:e),-1),t.getKey=(e,t)=>t*s.MAP_WIDTH+e;const n=[{x:0,y:-1,condition:(e,t)=>t>=1},{x:1,y:-1,condition:(e,t)=>e<s.MAP_WIDTH_1&&t>=1},{x:1,y:0,condition:(e,t)=>e<s.MAP_WIDTH_1},{x:1,y:1,condition:(e,t)=>e<s.MAP_WIDTH_1&&t<s.MAP_WIDTH_1},{x:0,y:1,condition:(e,t)=>t<s.MAP_WIDTH_1},{x:-1,y:1,condition:(e,t)=>e>=1&&t<s.MAP_WIDTH_1},{x:-1,y:0,condition:(e,t)=>e>=1},{x:-1,y:-1,condition:(e,t)=>e>=1&&t>=1}];t.combine=e=>{const a=[],i={};e.forEach((e=>{e.forEach((e=>{const{x:s,y:o}=e,n=(0,t.getKey)(s,o);i[n]||(i[n]=!0,a.push(e))}))}));const o=[];return a.forEach((({x:e,y:a,value:r})=>{r===s.TILES.SWORDRED&&n.forEach((({x:n,y:r,condition:l})=>{if(!l(e,a))return;const h=e+n,c=a+r,d=(0,t.getKey)(h,c);i[d]||(i[d]=!0,o.push({x:h,y:c,point:0,value:s.base.map[c][h]}))}))})),a.push(...o),a},t.loadTexture=e=>{const a=new Image;return a.src=(0,t.getImageSrc)(e),new Promise((e=>a.onload=()=>e(a)))}},774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animateSword=t.animateGainTile=t.clamp=void 0,t.clamp=(e,t,a)=>e<t?t:e>a?a:e,t.animateGainTile=e=>e,t.animateSword=e=>e*e},81:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSpringEffect=void 0,t.createSpringEffect=(e,t=2500,a=7,s=.5)=>{let i=e,o=1/60,n=0,r=!1;const l=[];for(;!r;){const e=n+(t*(0-i)-a*n)*o,h=i+e*o;r=Math.abs(e)<1/s&&Math.abs(h-0)<1/s,i=r?0:h,l.push(i),n=e}return l}}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}(()=>{const e=a(876),t=a(989),s=a(603),i=new t.Game;let o=0;const n=(t=0)=>{requestAnimationFrame(n);const a=t-o;a<e.INTERVAL||(o=t-a%e.INTERVAL,i.update(),i.render())};(async()=>{(()=>{const t=document.getElementById("canvas"),a=t.getContext("2d");t.width=e.SCREEN_WIDTH,t.height=e.SCREEN_HEIGHT,a.imageSmoothingEnabled=!1,e.base.canvas=t,e.base.context=a})(),await(0,s.loadTextures)(),i.init(),e.base.canvas.addEventListener("click",(e=>{i.onClick(e)})),document.addEventListener("keydown",(e=>{i.onKeyDown(e)})),n()})()})()})();
//# sourceMappingURL=index.js.map